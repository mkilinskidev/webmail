(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{"+v/2":function(e,t,i){"use strict";var s=i("o0Bx"),o=i("Jq2H");s.registerAbortRequestHandler(o.ServerModuleName,(function(e,t){switch(e.Method){case"GetFiles":return"GetFiles"===t.Method}return!1})),e.exports={send:function(e,t,i,n){s.send(o.ServerModuleName,e,t,i,n)},sendToWebclient:function(e,t,i,o){s.send("FilesWebclient",e,t,i,o)}}},"42lS":function(e,t,i){"use strict";var s=i("xG9w"),o=i("0h2I"),n=i("czxF");function r(){n.call(this),this.htmlEmbed=o.observable("")}s.extendOwn(r.prototype,n.prototype),r.prototype.PopupTemplate="CoreWebclient_EmbedHtmlPopup",r.prototype.onOpen=function(e){this.htmlEmbed(e)},r.prototype.close=function(){this.closePopup(),this.htmlEmbed("")},e.exports=new r},"4KVt":function(e,t,i){"use strict";var s=i("xG9w"),o=i("EVdn"),n=i("0h2I"),r=i("Yjhd"),a=i("czxF"),l=i("+v/2"),h=i("Pg7U");function c(){a.call(this),this.fCallback=null,this.link=n.observable(""),this.linkPrev=n.observable(""),this.linkFocus=n.observable(!1),this.checkTimeout=null,this.urlChecked=n.observable(!1),this.saveCommand=r.createCommand(this,this.executeSave,(function(){return this.urlChecked()})),this.fileItem=n.observable(null)}s.extendOwn(c.prototype,a.prototype),c.prototype.PopupTemplate="FilesWebclient_CreateLinkPopup",c.prototype.onOpen=function(e){this.link(""),this.linkFocus(!0),this.fCallback=e,this.checkTimer=setTimeout(s.bind(this.checkUrl,this),2e3)},c.prototype.checkUrl=function(){clearTimeout(this.checkTimer),this.link()!==this.linkPrev()&&(this.linkPrev(this.link()),l.send("CheckUrl",{Url:this.link()},this.onCheckUrlResponse,this)),this.checkTimer=setTimeout(s.bind(this.checkUrl,this),1e3)},c.prototype.onCheckUrlResponse=function(e,t){if(e.Result){var i=h.prepareLinkData(e.Result,this.link()),s=new h(i);this.fileItem(s),this.urlChecked(!0)}},c.prototype.executeSave=function(){o.isFunction(this.fCallback)&&(this.fCallback(this.fileItem()),this.link(""),this.linkPrev(""),this.urlChecked(!1)),clearTimeout(this.checkTimer),this.closePopup()},c.prototype.cancelPopup=function(){this.link(""),this.linkPrev(""),this.urlChecked(!1),clearTimeout(this.checkTimer),this.closePopup()},e.exports=new c},"5hOJ":function(e,t,i){"use strict";var s=i("wd/R"),o=i("RN+F"),n=i("Yjhd"),r=i("hPb3");function a(){this.iTimeStampInUTC=0,this.oMoment=null}a.prototype.parse=function(e){this.iTimeStampInUTC=e,this.oMoment=s.unix(this.iTimeStampInUTC)},a.prototype.setDate=function(e,t,i){this.oMoment=s([e,t,i])},a.prototype.getTimeFormat=function(){return r.timeFormat()===window.Enums.TimeFormat.F24?"HH:mm":"hh:mm A"},a.prototype.getFullDate=function(){return this.getDate()+" "+this.getTime()},a.prototype.getMidDate=function(){return this.getShortDate(!0)},a.prototype.getShortDate=function(e){var t="",i=null;return this.oMoment&&((i=s()).format("L")===this.oMoment.format("L")?t=this.oMoment.format(this.getTimeFormat()):(t=i.clone().subtract(1,"days").format("L")===this.oMoment.format("L")?o.i18n("COREWEBCLIENT/LABEL_YESTERDAY"):r.UserSelectsDateFormat?this.oMoment.format(n.getDateFormatForMoment(r.dateFormat())):i.year()===this.oMoment.year()?this.oMoment.format("MMM D"):this.oMoment.format("MMM D, YYYY"),e&&(t+=", "+this.oMoment.format(this.getTimeFormat())))),t},a.prototype.getDate=function(){var e="ddd, MMM D, YYYY";return r.UserSelectsDateFormat&&(e="ddd, "+n.getDateFormatForMoment(r.dateFormat())),this.oMoment?this.oMoment.format(e):""},a.prototype.getTime=function(){return this.oMoment?this.oMoment.format(this.getTimeFormat()):""},a.prototype.getTimeStampInUTC=function(){return this.iTimeStampInUTC},e.exports=a},"5jes":function(e,t,i){"use strict";e.exports=function(e){const t=i("RN+F"),s=i("IAk5");return i("OgeD").isModuleEnabled("FilesWebclient")&&s.isUserNormalOrTenant()?{start:function(e){s.subscribeEvent("MailWebclient::AddAllAttachmentsDownloadMethod",e=>{e({Text:t.i18n("MAILSAVEATTACHMENTSTOFILESPLUGIN/ACTION_SAVE_ATTACHMENTS_TO_FILES"),Handler:function(e,t,s){const o=i("76Kh"),n=i("zu1B");o.showPopup(n,[s,e])}})})}}:null}},Au6d:function(e,t,i){"use strict";var s=i("xG9w"),o=i("EVdn"),n=i("0h2I"),r=i("czxF");function a(){r.call(this),this.fCallback=null,this.folderName=n.observable(""),this.folderName.focus=n.observable(!1),this.folderName.error=n.observable(""),this.folderName.subscribe((function(){this.folderName.error("")}),this)}s.extendOwn(a.prototype,r.prototype),a.prototype.PopupTemplate="FilesWebclient_CreateFolderPopup",a.prototype.onOpen=function(e){this.folderName(""),this.folderName.focus(!0),this.folderName.error(""),o.isFunction(e)&&(this.fCallback=e)},a.prototype.onOKClick=function(){if(this.folderName.error(""),this.fCallback){var e=this.fCallback(this.folderName());e?this.folderName.error(""+e):setTimeout(function(){this.closePopup()}.bind(this))}else setTimeout(function(){this.closePopup()}.bind(this))},e.exports=new a},Jq2H:function(e,t,i){"use strict";i("0h2I");var s=i("xG9w"),o=i("AFLV");e.exports={ServerModuleName:"Files",CorporateServerModuleName:"CorporateFiles",PersonalServerModuleName:"PersonalFiles",HashModuleName:"files",CustomTabTitle:"",Storages:[],EnableUploadSizeLimit:!1,PublicFolderName:"",PublicHash:"",UploadSizeLimitMb:0,UserSpaceLimitMb:0,TenantSpaceLimitMb:0,CorporateSpaceLimitMb:0,EditFileNameWithoutExtension:!1,ShowCommonSettings:!0,ShowFilesApps:!0,BottomLeftCornerLinks:[],ShowPersonalFilesAdminSection:!1,ShowCorporateFilesAdminSection:!1,PublicLinksEnabled:!0,init:function(e){var t=e[this.ServerModuleName],i=e[this.CorporateServerModuleName],n=e.FilesWebclient;s.isEmpty(t)||(this.CustomTabTitle=o.pString(t.CustomTabTitle,this.CustomTabTitle),this.Storages=o.pArray(t.Storages,this.Storages),this.EnableUploadSizeLimit=o.pBool(t.EnableUploadSizeLimit,this.EnableUploadSizeLimit),this.PublicFolderName=o.pString(t.PublicFolderName,this.PublicFolderName),this.PublicHash=o.pString(t.PublicHash,this.PublicHash),this.UploadSizeLimitMb=o.pNonNegativeInt(t.UploadSizeLimitMb,this.UploadSizeLimitMb),this.UserSpaceLimitMb=o.pNonNegativeInt(t.UserSpaceLimitMb,this.UserSpaceLimitMb),this.TenantSpaceLimitMb=o.pNonNegativeInt(t.TenantSpaceLimitMb,this.TenantSpaceLimitMb)),this.ShowPersonalFilesAdminSection=!0,s.isEmpty(i)||(this.ShowCorporateFilesAdminSection=!0,this.CorporateSpaceLimitMb=o.pNonNegativeInt(i.SpaceLimitMb,this.CorporateSpaceLimitMb)),s.isEmpty(n)||(this.EditFileNameWithoutExtension=o.pBool(n.EditFileNameWithoutExtension,this.EditFileNameWithoutExtension),this.ShowCommonSettings=o.pBool(n.ShowCommonSettings,this.ShowCommonSettings),this.ShowFilesApps=o.pBool(n.ShowFilesApps,this.ShowFilesApps),this.BottomLeftCornerLinks=o.pArray(n.BottomLeftCornerLinks,this.BottomLeftCornerLinks),this.PublicLinksEnabled=o.pBool(n.PublicLinksEnabled,this.PublicLinksEnabled))},updateAdmin:function(e,t){this.EnableUploadSizeLimit=e,this.UploadSizeLimitMb=t},updateAdminPersonal:function(e){this.PersonalSpaceLimitMb=e},updateAdminCorporate:function(e){this.CorporateSpaceLimitMb=e}}},KM9R:function(e,t,i){"use strict";var s=i("xG9w"),o=i("0h2I"),n=i("RN+F"),r=i("ZP6a"),a=i("JFZZ"),l=i("czxF"),h=i("OgeD"),c=i("76Kh"),u=i("+v/2"),p=i("MTJk"),d=h.run("ActivityHistory","getShowHistoryPopup");function m(){l.call(this),this.item=null,this.pub=o.observable(""),this.pubFocus=o.observable(!1),this.bAllowShowHistory=!!d}s.extendOwn(m.prototype,l.prototype),m.prototype.PopupTemplate="FilesWebclient_SharePopup",m.prototype.onOpen=function(e){this.item=e,this.pub(""),u.send("CreatePublicLink",{Type:e.storageType(),Path:e.path(),Name:e.fileName(),Size:e instanceof p?0:e.size(),IsFolder:e instanceof p},this.onCreatePublicLinkResponse,this)},m.prototype.onCreatePublicLinkResponse=function(e){e.Result?(this.pub(r.getAppPath()+e.Result),this.pubFocus(!0),this.item.published(!0)):a.showErrorByCode(e,n.i18n("FILESWEBCLIENT/ERROR_CREATE_PUBLIC_LINK"))},m.prototype.onCancelSharingClick=function(){this.item&&(u.send("DeletePublicLink",{Type:this.item.storageType(),Path:this.item.path(),Name:this.item.fileName()},(function(e){e.Result?this.closePopup():a.showErrorByCode(e,n.i18n("FILESWEBCLIENT/ERROR_DELETE_PUBLIC_LINK"))}),this),this.item.published(!1))},m.prototype.showHistory=function(){this.bAllowShowHistory&&c.showPopup(d,[n.i18n("FILESWEBCLIENT/HEADING_HISTORY_POPUP"),this.item])},e.exports=new m},MTJk:function(e,t,i){"use strict";var s=i("xG9w"),o=i("0h2I"),n=i("RN+F"),r=i("AFLV"),a=i("IAk5"),l=i("cGGv"),h=i("oDKb");function c(e){this.oParent=e,this.selected=o.observable(!1),this.checked=o.observable(!1),this.deleted=o.observable(!1),this.recivedAnim=o.observable(!1).extend({autoResetToFalse:500}),this.published=o.observable(!1),this.fileName=o.observable(""),this.fullPath=o.observable(""),this.path=o.observable(""),this.storageType=o.observable(Enums.FileStorageType.Personal),this.id=o.observable(""),this.sMainAction="list",this.sOwnerName="",this.sInitiator="",this.oExtendedProps={},this.sharedWithMeAccessReshare=o.observable(!1),this.sharedWithMeAccessWrite=o.observable(!1),this.sharedWithMe=o.observable(!1),this.sharedWithOthers=o.observable(!1),this.readOnly=o.computed((function(){return this.sharedWithMe()&&!this.sharedWithMeAccessWrite()}),this),this.uploadingFilesCount=o.observable(0),this.uploadedFilesCount=o.observable(0),this.progressPercent=o.computed((function(){return this.uploadingFilesCount()>0?Math.floor(this.uploadedFilesCount()/this.uploadingFilesCount()*100):0}),this),this.isIncomplete=o.computed((function(){return this.uploadingFilesCount()>0}),this),this.uploaded=o.computed((function(){return 0===this.uploadingFilesCount()}),this),this.allowDrag=o.computed((function(){return!e.bInPopup&&!this.isIncomplete()&&!a.isPublic()}),this),this.allowDrop=o.computed((function(){if(!this.oParent.bInPopup&&!this.isIncomplete()){var e=this.oParent.sharedParentFolder();if(e)return e.sharedWithMeAccessWrite();if(this.storageType()!==Enums.FileStorageType.Shared)return!this.sharedWithMe()||this.sharedWithMeAccessWrite()&&(!this.oParent.selectedHasShared()||this.oParent.needToCopyDraggedItems())}return!1}),this)}s.extendOwn(c.prototype,h),c.prototype.parse=function(e){this.published(!!e.Published),this.fileName(r.pString(e.Name)),this.fullPath(r.pString(e.FullPath)),this.path(r.pString(e.Path)),this.storageType(r.pString(e.Type)),this.id(r.pString(e.Id)),e.MainAction&&(this.sMainAction=r.pString(e.MainAction)),this.sOwnerName=r.pString(e.Owner),this.sInitiator=r.pString(e.Initiator,this.sOwnerName),this.oExtendedProps=r.pObject(e.ExtendedProps),this.parseExtendedProps(),this.displayName=o.computed((function(){return this.storageType()!==Enums.FileStorageType.Shared||this.oParent.sharedParentFolder()?this.fileName():this.fullPath().replace(/^\//,"")}),this),this.sHeaderText=function(){return this.sharedWithMe()&&this.sInitiator?n.i18n("FILESWEBCLIENT/INFO_SHARED_BY",{OWNER:this.sInitiator}):""}.bind(this)(),a.broadcastEvent("FilesWebclient::ParseFolder::after",[this,e])},c.prototype.getMainAction=function(){return this.sMainAction},c.prototype.increaseUploadingFiles=function(){return this.uploadingFilesCount(this.uploadingFilesCount()+1)},c.prototype.increaseUploadedFiles=function(){return this.uploadedFilesCount(this.uploadedFilesCount()+1)},c.prototype.eventDragStart=l.prototype.eventDragStart,e.exports=c},Pg7U:function(e,t,i){"use strict";var s=i("xG9w"),o=i("0h2I"),n=i("wd/R"),r=i("RN+F"),a=i("AFLV"),l=i("Yjhd"),h=i("IAk5"),c=i("ZCBP"),u=i("cGGv"),p=i("5hOJ"),d=i("76Kh"),m=i("42lS"),f=i("oDKb"),b=window.Enums;function y(e,t){this.oParent=a.pObject(t),this.IS_FILE=!0,this.storageType=o.observable(a.pString(e.Type)),this.sLastModified=y.parseLastModified(e.LastModified),this.iLastModified=a.pInt(e.LastModified),this.path=o.observable(a.pString(e.Path)),this.fullPath=o.observable(a.pString(e.FullPath)),this.selected=o.observable(!1),this.checked=o.observable(!1),this.bIsLink=!!e.IsLink,this.sLinkType=this.bIsLink?a.pString(e.LinkType):"",this.sLinkUrl=this.bIsLink?a.pString(e.LinkUrl):"",this.sThumbnailExternalLink=this.bIsLink?a.pString(e.ThumbnailUrl):"",this.deleted=o.observable(!1),this.recivedAnim=o.observable(!1).extend({autoResetToFalse:500}),this.published=o.observable(!1),this.sOwnerName=a.pString(e.Owner),this.sInitiator=a.pString(e.Initiator,this.sOwnerName),u.call(this),this.oExtendedProps=a.pObject(e.ExtendedProps),this.sharedWithMeAccessReshare=o.observable(!1),this.sharedWithMeAccessWrite=o.observable(!1),this.sharedWithMe=o.observable(!1),this.sharedWithOthers=o.observable(!1),this.parseExtendedProps(),this.displayName=o.computed((function(){return this.storageType()===b.FileStorageType.Shared&&this.oParent.sharedParentFolder&&!this.oParent.sharedParentFolder()?this.fullPath().replace(/^\//,""):this.fileName()}),this),this.content=o.observable(""),this.thumbUrlInQueueSubscribtion.dispose(),this.thumbUrlInQueue.subscribe((function(){""!==this.sThumbnailExternalLink?this.thumbnailSrc(this.sThumbnailExternalLink):this.bIsLink||this.getInThumbQueue()}),this),this.visibleCancelButton=o.computed((function(){return this.visibleProgress()&&100!==this.progressPercent()}),this),this.progressText=o.computed((function(){return r.i18n("COREWEBCLIENT/LABEL_UPLOADING_PERCENT",{PERCENT:this.progressPercent()})}),this),this.oActionsData.list={Text:r.i18n("COREWEBCLIENT/ACTION_VIEW_FILE"),Handler:s.bind((function(){h.broadcastEvent("Files::ShowList",{Item:this})}),this)},this.oActionsData.open={Text:r.i18n("COREWEBCLIENT/ACTION_OPEN_LINK"),Handler:s.bind(this.openLink,this)},this.iconAction(""),this.sHeaderText=s.bind((function(){if(this.sharedWithMe()&&this.sInitiator)return r.i18n("FILESWEBCLIENT/INFO_SHARED_BY",{OWNER:this.sInitiator});if(this.sLastModified){var e=""!==this.sOwnerName?"FILESWEBCLIENT/INFO_OWNER_AND_DATA":"FILESWEBCLIENT/INFO_DATA";return r.i18n(e,{OWNER:this.sOwnerName,LASTMODIFIED:this.sLastModified})}return""}),this)(),this.type=this.storageType,this.canShare=o.computed((function(){return this.storageType()===b.FileStorageType.Personal||this.storageType()===b.FileStorageType.Corporate}),this),this.sHtmlEmbed=a.pString(e.OembedHtml),this.commonParseActions(e),this.cssClasses=o.computed((function(){var e=this.getCommonClasses();return this.allowDrag()&&e.push("dragHandle"),this.selected()&&e.push("selected"),this.checked()&&e.push("checked"),this.deleted()&&e.push("deleted"),this.allowPublicLink()&&this.published()&&e.push("published"),this.bIsLink&&e.push("aslink"),e.join(" ")}),this),this.parse(e,!!this.oParent.bInPopup)}s.extendOwn(y.prototype,u.prototype),s.extendOwn(y.prototype,f),y.parseLastModified=function(e){var t=new p;return e?(t.parse(e),t.getShortDate()):""},y.prepareLinkData=function(e,t){return{IsLink:!0,LinkType:e.LinkType,LinkUrl:t,Name:e.Name,Size:e.Size,ThumbnailUrl:e.Thumb}},y.prototype.parse=function(e,t){this.uploaded(!0),this.allowDrag(!t&&!h.isPublic()),this.allowUpload(!0),this.allowPublicLink(!0),this.allowActions(!t&&""!==this.fullPath()),this.fileName(a.pString(e.Name)),this.content(a.pString(e.Content)),this.id(a.pString(e.Id)),this.published(!!e.Published),this.size(a.pInt(e.Size)),this.hash(a.pString(e.Hash)),this.thumbUrlInQueue(""!==a.pString(e.ThumbnailUrl)?a.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.mimeType(a.pString(e.ContentType)),this.bHasHtmlEmbed=!t&&""!==this.fullPath()&&"oembeded"===this.sLinkType,this.bHasHtmlEmbed&&this.iconAction("view"),this.isViewSupported()||this.bHasHtmlEmbed||this.actions(s.without(this.actions(),"view")),h.broadcastEvent("FilesWebclient::ParseFile::after",[this,e])},y.prepareUploadFileData=function(e,t,i,s){var o=e.FileName,r=l.getFileExtension(o),a=l.getFileNameWithoutExtension(o),c=0;for(""!==r&&(r="."+r);s(o);)o=a+" ("+c+")"+r,c++;return e.FileName=o,{Name:o,LastModified:n().unix(),Owner:h.getUserPublicId(),Path:t,FullPath:t+"/"+o,Type:i,ContentType:e.Type,Size:e.Size}},y.prototype.viewFile=function(e,t){t&&(t.ctrlKey||t.shiftKey)||(""!==this.sHtmlEmbed?d.showPopup(m,[this.sHtmlEmbed]):this.bIsLink?this.viewCommonFile(this.sLinkUrl):this.viewCommonFile())},y.prototype.openLink=function(){this.bIsLink&&c.openTab(this.sLinkUrl)},y.prototype.commonParseActions=function(e){s.each(e.Actions,(function(e,t){this.oActionsData[t]||(this.oActionsData[t]={});var i="";"download"!==t&&"view"!==t||(i="&"+l.getRandomHash()),this.oActionsData[t].Url=a.pString(e.url)+i,this.actions.push(t)}),this)},e.exports=y},QFUI:function(e,t,i){"use strict";var s,o,n=i("RN+F"),r=i("76Kh"),a=i("1grR"),l=i("hPb3"),h={};h.getDownloadLink=function(e,t,i){return t.length>0?"?/Download/"+e+"/DownloadFile/"+t+"/"+(i?"0/"+i:""):""},h.getIframeWrappwer=function(e,t){return"?/Raw/Iframe/"+e+"/"+window.encodeURIComponent(t)+"/"},h.thumbQueue=(s={},o={},function(e,t){t?!(e in o)||o[e]>0?(e in o||(o[e]=2,s[e]=[]),o[e]--,t(e)):s[e].push({imageSrc:e,imageSrcObserver:t}):s[e]&&s[e].length&&(s[e][0].imageSrcObserver(s[e][0].imageSrc),s[e].shift())}),h.showErrorIfAttachmentSizeLimit=function(e,t){var i=n.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE_DETAILED",{FILENAME:e,MAXSIZE:n.getFriendlySize(l.AttachmentSizeLimit)});return l.AttachmentSizeLimit>0&&t>l.AttachmentSizeLimit&&(r.showPopup(a,[i]),!0)},e.exports=h},cGGv:function(e,t,i){"use strict";var s=i("xG9w"),o=i("EVdn"),n=i("0h2I"),r=i("wd/R"),a=i("IAk5"),l=i("QFUI"),h=i("RN+F"),c=i("AFLV"),u=i("ZP6a"),p=i("Yjhd"),d=i("ZCBP"),m=["image/jpeg","image/jpg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript"],f=[];function b(){this.id=n.observable(""),this.index=n.observable(0),this.fileName=n.observable(""),this.tempName=n.observable(""),this.extension=n.observable(""),this.fileName.subscribe((function(e){this.id(e),this.extension(p.getFileExtension(e))}),this),this.displayName=n.computed((function(){return this.fileName()}),this),this.size=n.observable(0),this.friendlySize=n.computed((function(){return this.size()>0?h.getFriendlySize(this.size()):""}),this),this.hash=n.observable(""),this.thumbUrlInQueue=n.observable(""),this.thumbUrlInQueueSubscribtion=this.thumbUrlInQueue.subscribe((function(){this.getInThumbQueue()}),this),this.thumbnailSrc=n.observable(""),this.thumbnailLoaded=n.observable(!1),this.mimeType=n.observable(""),this.uploadUid=n.observable(""),this.uploaded=n.observable(!1),this.uploadError=n.observable(!1),this.downloading=n.observable(!1),this.isViewMimeType=n.computed((function(){return-1!==o.inArray(this.mimeType(),m)}),this),this.bHasHtmlEmbed=!1,this.otherTemplates=n.observableArray([]),this.visibleCancelButton=n.observable(!0),this.cancelButtonTooltip=h.i18n("COREWEBCLIENT/ACTION_CANCEL"),this.statusText=n.observable(""),this.statusTooltip=n.computed((function(){return this.uploadError()?this.statusText():""}),this),this.progressPercent=n.observable(0),this.visibleProgress=n.observable(!1),this.uploadStarted=n.observable(!1),this.uploadStarted.subscribe((function(){this.uploadStarted()?(this.uploaded(!1),this.visibleProgress(!0),this.progressPercent(20)):(this.progressPercent(100),this.visibleProgress(!1),this.uploaded(!0))}),this),this.downloading.subscribe((function(){this.downloading()?this.visibleProgress(!0):(this.visibleProgress(!1),this.progressPercent(0))}),this),this.allowDrag=n.observable(!1),this.allowUpload=n.observable(!1),this.allowPublicLink=n.observable(!1),this.bIsSecure=n.observable(!1),this.sHeaderText="",this.oActionsData={view:{Text:h.i18n("COREWEBCLIENT/ACTION_VIEW_FILE"),HandlerName:"viewFile"},download:{Text:h.i18n("COREWEBCLIENT/ACTION_DOWNLOAD_FILE"),HandlerName:"downloadFile",Tooltip:n.computed((function(){var e=h.i18n("COREWEBCLIENT/INFO_CLICK_TO_DOWNLOAD_FILE",{FILENAME:this.fileName(),SIZE:this.friendlySize()});return""===this.friendlySize()&&(e=e.replace(" ()","")),e}),this)}},this.allowActions=n.observable(!0),this.iconAction=n.observable("download"),this.cssClasses=n.computed((function(){return this.getCommonClasses().join(" ")}),this),this.actions=n.observableArray([]),this.firstAction=n.computed((function(){return this.actions().length>1?this.actions()[0]:""}),this),this.secondAction=n.computed((function(){return 1===this.actions().length?this.actions()[0]:this.actions().length>1?this.actions()[1]:""}),this),this.subFiles=n.observableArray([]),this.subFilesExpanded=n.observable(!1),this.sUploadSubFolder="",this.bIsHidden=!1}o("html").hasClass("pdf")&&(m.push("application/pdf"),m.push("application/x-pdf")),b.prototype.addAction=function(e,t,i){t?this.actions.unshift(e):this.actions.push(e),this.actions(s.compact(this.actions())),i&&(this.oActionsData[e]=i)},b.prototype.removeAction=function(e){this.actions(s.without(this.actions(),e))},b.prototype.getMainAction=function(){return this.actions()[0]},b.prototype.hasAction=function(e){return-1!==s.indexOf(this.actions(),e)},b.prototype.getActionText=function(e){return this.hasAction(e)&&this.oActionsData[e]&&("string"==typeof this.oActionsData[e].Text||s.isFunction(this.oActionsData[e].Text))?s.isFunction(this.oActionsData[e].Text)?this.oActionsData[e].Text():this.oActionsData[e].Text:""},b.prototype.getActionUrl=function(e){return this.hasAction(e)&&this.oActionsData[e]&&this.oActionsData[e].Url||""},b.prototype.executeAction=function(e){var t=this.hasAction(e)&&this.oActionsData[e];t&&(s.isFunction(t.Handler)?t.Handler():"string"==typeof t.HandlerName&&s.isFunction(this[t.HandlerName])&&this[t.HandlerName]())},b.prototype.getTooltip=function(e){var t=this.hasAction(e)&&this.oActionsData[e]?this.oActionsData[e].Tooltip:"";return"string"==typeof t?t:s.isFunction(t)?t():""},b.prototype.getCommonClasses=function(){var e=[];return(this.allowUpload()&&!this.uploaded()||this.downloading())&&e.push("incomplete"),this.uploadError()?e.push("fail"):e.push("success"),e},b.prototype.parse=function(e){this.fileName(c.pString(e.FileName)),this.tempName(c.pString(e.TempName)),""===this.tempName()&&this.tempName(this.fileName()),this.mimeType(c.pString(e.MimeType)),this.size(e.EstimatedSize?c.pInt(e.EstimatedSize):c.pInt(e.SizeInBytes)),this.hash(c.pString(e.Hash)),this.parseActions(e),this.uploadUid(this.hash()),this.uploaded(!0),o.isFunction(this.additionalParse)&&this.additionalParse(e)},b.prototype.parseActions=function(e){this.thumbUrlInQueue(""!==c.pString(e.ThumbnailUrl)?c.pString(e.ThumbnailUrl)+"/"+Math.random():""),this.commonParseActions(e),this.commonExcludeActions()},b.prototype.commonExcludeActions=function(){this.isViewSupported()||this.actions(s.without(this.actions(),"view"))},b.prototype.commonParseActions=function(e){s.each(e.Actions,(function(e,t){this.oActionsData[t]||(this.oActionsData[t]={}),this.oActionsData[t].Url=c.pString(e.url),this.actions.push(t)}),this)},b.addViewExtensions=function(e){s.isArray(e)&&(f=s.union(f,e))},b.prototype.isViewSupported=function(){return-1!==o.inArray(this.mimeType(),m)||-1!==o.inArray(this.extension(),f)},b.prototype.getInThumbQueue=function(){""===this.thumbUrlInQueue()||this.linked&&(!this.linked||this.linked())||l.thumbQueue(this.thumbUrlInQueue(),this.thumbnailSrc)},b.prototype.downloadFile=function(e){var t=this.getActionUrl("download"),i={File:this,CancelDownload:!1};t.length>0&&"#"!==t&&(e||a.broadcastEvent("AbstractFileModel::FileDownload::before",i),i.CancelDownload||(s.isFunction(i.CustomDownloadHandler)?i.CustomDownloadHandler():(t+="/"+r().unix(),u.downloadByUrl(t,"eml"===this.extension()))))},b.prototype.viewFile=function(e,t){p.calmEvent(t),this.viewCommonFile()},b.prototype.viewCommonFile=function(e){var t=null,i=null;c.isNonEmptyString(e)||(e=u.getAppPath()+this.getActionUrl("view")),e.length>0&&"#"!==e&&(i={sUrl:e+="/"+r().unix(),index:this.index(),hash:this.hash(),continueView:!0},a.broadcastEvent("AbstractFileModel::FileView::before",i),i.continueView&&(t=d.open(i.sUrl,i.sUrl,!1))&&t.focus())},b.prototype.eventDragStart=function(e,t){var i=t.originalEvent||t;return e&&i&&i.dataTransfer&&i.dataTransfer.setData&&i.dataTransfer.setData("DownloadURL",this.generateTransferDownloadUrl()),!0},b.prototype.generateTransferDownloadUrl=function(){var e=this.getActionUrl("download");return"http"!==e.substr(0,4)&&(e=u.getAppPath()+e),this.mimeType()+":"+this.fileName()+":"+e},b.prototype.onUploadSelect=function(e,t,i){i||(this.fileName(c.pString(t.FileName)),this.mimeType(c.pString(t.Type)),this.size(c.pInt(t.Size))),this.uploadUid(e),this.uploaded(!1),this.statusText(""),this.progressPercent(0),this.visibleProgress(!1),this.sUploadSubFolder=c.pString(t.Folder),this.bIsHidden=""!==this.sUploadSubFolder},b.prototype.onUploadStart=function(){this.visibleProgress(!0)},b.prototype.onUploadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(!0))},b.prototype.onDownloadProgress=function(e,t){t>0&&(this.progressPercent(Math.ceil(e/t*100)),this.visibleProgress(this.progressPercent()<100))},b.prototype.onUploadComplete=function(e,t,i){var s,o=!(t&&i&&!i.ErrorCode&&i.Result&&!i.Result.Error),n=i&&i.ErrorCode&&i.ErrorCode===Enums.Errors.CanNotUploadFileLimit?h.i18n("COREWEBCLIENT/ERROR_UPLOAD_SIZE"):h.i18n("COREWEBCLIENT/ERROR_UPLOAD_UNKNOWN");this.progressPercent(0),this.visibleProgress(!1),this.uploaded(!0),this.uploadError(o),this.statusText(o?n:h.i18n("COREWEBCLIENT/REPORT_UPLOAD_COMPLETE")),o||(this.fillDataAfterUploadComplete(i,e),setTimeout((s=this,function(){s.statusText("")}),3e3))},b.prototype.fillDataAfterUploadComplete=function(e,t){},b.prototype.onImageLoad=function(e,t){""===this.thumbUrlInQueue()||this.thumbnailLoaded()||(this.thumbnailLoaded(!0),l.thumbQueue(this.thumbUrlInQueue()))},b.prototype.stopDownloading=function(){this.downloading(!1)},b.prototype.startDownloading=function(){this.downloading(!0)},e.exports=b},dtb0:function(e,t,i){"use strict";var s=i("xG9w"),o=i("EVdn"),n=i("0h2I"),r=i("RN+F"),a=i("AFLV"),l=i("Yjhd"),h=i("JFZZ"),c=i("IAk5"),u=i("mjrp"),p=i("kwPS"),d=i("OgeD"),m=i("QaF5"),f=i("SQrT"),b=i("hPb3"),y=i("xcwT"),g=i("76Kh"),E=i("1grR"),S=i("20Ah"),F=i("Au6d"),v=i("4KVt"),P=i("qsz4"),T=i("KM9R"),C=d.run("SharedFiles","getFilesSharePopup"),L=d.run("MailWebclient","getComposeMessageWithAttachments"),A=i("p2SF"),I=i("+v/2"),w=i("Jq2H"),D=i("Pg7U"),N=i("MTJk"),k=window.Enums;function R(e,t=!0){y.call(this,"FilesWebclient"),this.disableRoute=!1,this.browserTitle=n.observable(r.i18n("FILESWEBCLIENT/HEADING_BROWSER_TAB")),this.bAllowSendEmails=s.isFunction(L),this.error=n.observable(!1),this.loaded=n.observable(!1),this.bPublic=c.isPublic(),this.storages=n.observableArray([]),this.folders=n.observableArray(),this.files=n.observableArray(),this.uploadingFiles=n.observableArray(),this.rootPath=n.observable(this.bPublic?w.PublicFolderName:r.i18n("FILESWEBCLIENT/LABEL_PERSONAL_STORAGE")),this.storageType=n.observable(k.FileStorageType.Personal),this.currentStorage=n.computed((function(){return this.getStorageByType(this.storageType())}),this),this.storageDroppable=n.computed((function(){return this.currentStorage()?this.currentStorage().droppable():""}),this),this.storageDisplayName=n.computed((function(){return this.currentStorage()?this.currentStorage().displayName:""}),this),this.storageType.subscribe((function(){this.bPublic?this.rootPath(w.PublicFolderName):(this.currentStorage()&&this.rootPath(this.currentStorage().displayName),this.selector.listCheckedAndSelected(!1))}),this),this.createButtonsControllers=n.observableArray([]),this.pathItems=n.observableArray(),this.currentPath=n.observable(""),this.isZipFolder=n.computed((function(){var e=this.currentPath().split("$ZIP:");return"zip"===l.getFileExtension(e[0])}),this),this.dropPath=n.observable(""),n.computed((function(){this.dropPath(this.currentPath())}),this),this.isCorporateStorage=n.computed((function(){return this.storageType()===k.FileStorageType.Corporate}),this),this.isSharedStorage=n.computed((function(){return this.storageType()===k.FileStorageType.Shared}),this),this.isEncryptedStorage=n.computed((function(){return this.storageType()===k.FileStorageType.Encrypted}),this),this.isExternalStorage=n.computed((function(){return this.currentStorage()&&this.currentStorage().isExternal}),this),this.filesCollection=n.computed((function(){var e=s.union(this.files(),this.getUploadingFiles());return e.sort((function(e,t){return e.fileName()===t.fileName()?0:e.fileName()<t.fileName()?-1:1})),e}),this),this.collection=n.computed((function(){return s.union(this.folders(),this.filesCollection())}),this),this.columnCount=n.observable(1),this.selector=new p(this.collection,s.bind(this.onItemSelect,this),s.bind(this.onItemDelete,this),s.bind(this.onItemDblClick,this),s.bind(this.onEnter,this),this.columnCount,!0,!0,!0,!1,t),this.firstSelectedFile=n.computed((function(){return s.find(this.selector.listCheckedAndSelected(),(function(e){return e.IS_FILE}))}),this),this.selectedOwnItems=n.computed((function(){return s.filter(this.selector.listCheckedAndSelected(),(function(e){return!e.sharedWithMe()}))}),this),this.selectedHasShared=n.computed((function(){return!!s.find(this.selector.listCheckedAndSelected(),(function(e){return e.sharedWithMe()}))}),this),this.searchPattern=n.observable(""),this.newSearchPattern=n.observable(""),this.isSearchFocused=n.observable(!1),this.selectedFiles=n.computed((function(){return s.filter(this.selector.listCheckedAndSelected(),(function(e){return e.IS_FILE}),this)}),this),this.allSelectedFilesReady=n.computed((function(){return s.every(this.selectedFiles(),(function(e){var t=!1===e.uploaded(),i=!0===e.downloading();return!t&&!i}))}),this),this.sharedParentFolder=n.computed((function(){return s.find(this.pathItems(),(function(e){return e.sharedWithMe()}))}),this),this.isDownloadAllowed=n.computed((function(){var e=this.getFileIfOnlyOneSelected();return!!e&&e.hasAction("download")&&this.allSelectedFilesReady()}),this),this.downloadCommand=l.createCommand(this,this.executeDownload,this.isDownloadAllowed),this.isSendAllowed=n.computed((function(){return!this.isZipFolder()&&this.selectedFiles().length>0&&this.allSelectedFilesReady()}),this),this.sendCommand=l.createCommand(this,this.executeSend,this.isSendAllowed),this.isRenameAllowed=n.computed((function(){var e=this.sharedParentFolder(),t=this.selector.listCheckedAndSelected(),i=1===t.length?t[0]:null;return!this.isZipFolder()&&(!e||e.sharedWithMeAccessWrite())&&this.allSelectedFilesReady()&&i}),this),this.renameCommand=l.createCommand(this,this.executeRename,this.isRenameAllowed),this.itemsToDeleteCount=n.computed((function(){var e=this.sharedParentFolder();return e&&e.sharedWithMeAccessWrite()?this.selector.listCheckedAndSelected().length:this.selectedOwnItems().length}),this),this.isDeleteAllowed=n.computed((function(){return!this.isZipFolder()&&this.itemsToDeleteCount()>0&&this.allSelectedFilesReady()}),this),this.deleteCommand=l.createCommand(this,this.executeDelete,this.isDeleteAllowed),this.needToCopyDraggedItems=n.observable(!1),this.isCutAllowed=n.computed((function(){var e=this.sharedParentFolder(),t=this.selector.listCheckedAndSelected();return!this.isZipFolder()&&(!e&&!this.isSharedStorage()||!!e&&e.sharedWithMeAccessWrite())&&this.allSelectedFilesReady()&&t.length>0}),this),this.isCopyAllowed=n.computed((function(){return this.allSelectedFilesReady()&&this.selector.listCheckedAndSelected().length>0}),this),this.isDragAllowed=n.computed((function(){return this.isCutAllowed()||this.needToCopyDraggedItems()&&this.isCopyAllowed()}),this),this.isShareAllowed=n.computed((function(){const e=this.selector.listCheckedAndSelected(),t=1===e.length?e[0]:null;t&&t.oExtendedProps;return!this.isZipFolder()&&t&&!t.bIsLink&&(!this.sharedParentFolder()||this.sharedParentFolder().sharedWithMeAccessReshare()||t.sharedWithMeAccessReshare())&&this.allSelectedFilesReady()&&(t.IS_FILE||!this.isEncryptedStorage())&&(!t.sharedWithMe()||t.sharedWithMeAccessReshare())}),this),this.createPublicLinkCommand=l.createCommand(this,this.createPublicLink,this.isShareAllowed),this.isCreateAllowed=n.computed((function(){var e=this.sharedParentFolder();return!this.isZipFolder()&&(e&&e.sharedWithMeAccessWrite()||!e&&!this.isSharedStorage())}),this),this.createFolderCommand=l.createCommand(this,this.executeCreateFolder,this.isCreateAllowed),this.isCreateShortcutAllowed=n.computed((function(){return this.isCreateAllowed()&&!this.isExternalStorage()&&!this.isEncryptedStorage()}),this),this.createShortcutCommand=l.createCommand(this,this.executeCreateShortcut,this.isCreateShortcutAllowed),this.uploaderButton=n.observable(null),this.uploaderArea=n.observable(null),this.bDragActive=n.observable(!1),this.isNewItemsMenuOpened=n.observable(!1),this.bDragActiveComp=n.computed((function(){return this.bDragActive()&&""===this.searchPattern()}),this),this.isDragAndDropSupported=n.observable(!1),this.isCreateAllowed.subscribe((function(){this.oJua&&this.oJua.setDragAndDropEnabledStatus(this.isCreateAllowed())}),this),this.uploadError=n.observable(!1),this.quota=n.observable(0),this.used=n.observable(0),this.quotaDesc=n.observable(""),this.quotaProc=n.observable(-1),this.bShowQuotaBarTextAsTooltip=b.ShowQuotaBarTextAsTooltip,this.aBottomLeftCornerLinks=w.BottomLeftCornerLinks,n.computed((function(){if(!b.ShowQuotaBar)return!0;var e=this.quota(),t=this.used(),i=0<e?Math.round(t/e*100):-1;i=100<i?100:i,this.quotaProc(i),this.quotaDesc(-1<i?r.i18n("COREWEBCLIENT/INFO_QUOTA",{PROC:i,QUOTA:r.getFriendlySize(e)}):""),b.QuotaWarningPerc>0&&-1!==i&&b.QuotaWarningPerc>100-i&&f.showError(r.i18n("COREWEBCLIENT/WARNING_QUOTA_ALMOST_REACHED"),!0)}),this),this.dragover=n.observable(!1),this.loading=n.observable(!1),this.loadedFiles=n.observable(!1),this.fileListInfoText=n.computed((function(){var e="";return this.loading()?e=r.i18n("COREWEBCLIENT/INFO_LOADING"):this.loadedFiles()?0===this.collection().length&&(""!==this.searchPattern()?e=r.i18n("FILESWEBCLIENT/INFO_NOTHING_FOUND"):this.isSharedStorage()?e=r.i18n("FILESWEBCLIENT/INFO_SHARED_FOLDER_IS_EMPTY"):""!==this.currentPath()||this.bInPopup||this.bPublic?e=r.i18n("FILESWEBCLIENT/INFO_FOLDER_IS_EMPTY"):this.isDragAndDropSupported()&&(e=r.i18n("FILESWEBCLIENT/INFO_DRAGNDROP_FILES_OR_CREATE_FOLDER"))):this.error()&&(e=r.i18n("FILESWEBCLIENT/ERROR_FILES_NOT_RECEIVED")),e}),this),this.bInPopup=!!e,this.timerId=null;var i={View:this,TemplateName:"FilesWebclient_ItemsView"};this.itemsViewTemplate=n.observable(i.TemplateName),c.broadcastEvent("Files::ChangeItemsView",i),this.addToolbarButtons=n.observableArray([]),c.subscribeEvent("Files::ShowList",s.bind((function(e){this.shown()&&e.Item&&this.routeFiles(e.Item.storageType(),e.Item.fullPath())}),this)),c.broadcastEvent("FilesWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this}),S.opened.subscribe(s.bind((function(){this.shown()&&this.selector.useKeyboardKeys(!0)}),this)),this.PublicLinksEnabled=w.PublicLinksEnabled}s.extendOwn(R.prototype,y.prototype),R.prototype.ViewTemplate=c.isPublic()?"FilesWebclient_PublicFilesView":"FilesWebclient_FilesView",R.prototype.ViewConstructorName="CFilesView",R.prototype.registerCreateButtonsController=function(e){this.createButtonsControllers.push(e)},R.prototype.onBind=function(e){var t=this.$viewDom||e;this.selector.initOnApplyBindings(".items_sub_list .item",".items_sub_list .selected.item",".items_sub_list .item .custom_checkbox",o(".panel.files .items_list",t),o(".panel.files .items_list .files_scroll.scroll-inner",t)),this.initUploader(),this.hotKeysBind()},R.prototype.hotKeysBind=function(){o(document).on("keydown",s.bind((function(e){this.shown()&&e&&e.keyCode===k.Key.s&&this.selector.useKeyboardKeys()&&!l.isTextFieldFocused()&&(e.preventDefault(),this.isSearchFocused(!0))}),this))},R.prototype.initUploader=function(){var e=this;!this.bPublic&&this.uploaderButton()&&this.uploaderArea()&&(this.oJua=new u({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:this.uploaderButton(),hiddenElementsPosition:b.IsRTL?"right":"left",dragAndDropElement:this.uploaderArea(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,hidden:s.extendOwn({Module:w.ServerModuleName,Method:"UploadFile",Parameters:function(t){return JSON.stringify({Type:e.storageType(),SubPath:t&&t.Folder||"",Path:e.dropPath(),Overwrite:!1})}},c.getCommonRequestParameters())}),this.oJua.on("onProgress",s.bind(this.onFileUploadProgress,this)).on("onSelect",s.bind(this.onFileUploadSelect,this)).on("onStart",s.bind(this.onFileUploadStart,this)).on("onDrop",s.bind(this.onDrop,this)).on("onComplete",s.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",s.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",s.bind(this.bDragActive,this,!1)).on("onCancel",s.bind(this.onCancelUpload,this)).on("onDialog",s.bind((function(){setTimeout(s.bind(this.isNewItemsMenuOpened,this,!1),10)}),this,!1)),this.isDragAndDropSupported(this.oJua.isDragAndDropSupported()))},R.prototype.isFileCanBeUploaded=function(e){return w.EnableUploadSizeLimit&&e.Size/1048576>w.UploadSizeLimitMb?(g.showPopup(E,[r.i18n("FILESWEBCLIENT/ERROR_SIZE_LIMIT",{FILENAME:e.FileName,SIZE:w.UploadSizeLimitMb})]),!1):!(this.storageType()===k.FileStorageType.Personal&&a.isPositiveNumber(this.quota())&&this.quota()>0&&this.used()+e.Size>this.quota())||(g.showPopup(E,[r.i18n("COREWEBCLIENT/ERROR_CANT_UPLOAD_FILE_QUOTA")]),!1)},R.prototype.onFileUploadSelect=function(e,t){if(!this.isFileCanBeUploaded(t))return!1;if(""===this.searchPattern()){const i=e=>!!this.getFileByName(e)||!!s.find(this.getUploadingFiles(),(function(t){return t.fileName()===e})),o=this.storageType(),n=this.currentPath(),r=D.prepareUploadFileData(t,n,o,i);let a=this.getUploadFileByUid(e);return a?(a.fileName(r.Name),a.fullPath(r.FullPath)):a=new D(r,this),a.onUploadSelect(e,t,!0),this.uploadingFiles.push(a),this.onFileFromSubfolderUploadSelect(t),!0}return!1},R.prototype.onFileFromSubfolderUploadSelect=function(e){if(a.isNonEmptyString(e.Folder)){var t=s.compact(e.Folder.split("/"))[0],i=s.find(this.folders(),(function(e){return e.fileName()===t}));t&&!i&&((i=new N(this)).parse({Name:t}),this.folders.push(i)),i.increaseUploadingFiles()}},R.prototype.onFileUploadStart=function(e){var t=this.getUploadFileByUid(e);t&&t.onUploadStart()},R.prototype.onFileUploadProgress=function(e,t,i){if(""===this.searchPattern()){var s=this.getUploadFileByUid(e);s&&s.onUploadProgress(t,i)}},R.prototype.onFileUploadComplete=function(e,t,i){if(""===this.searchPattern()){var s=this.getUploadFileByUid(e),o=!1;s?(s.onUploadComplete(e,t,i),this.onFileWithSubfolderUploadComplete(s),this.deleteUploadFileByUid(e),s.uploadError()?(this.uploadError(!0),i&&i.ErrorCode===k.Errors.CanNotUploadFileQuota?(g.showPopup(E,[r.i18n("COREWEBCLIENT/ERROR_CANT_UPLOAD_FILE_QUOTA")]),o=!0):i&&i.ErrorCode===k.Errors.FileAlreadyExists?(o=!0,f.showError(r.i18n("COREWEBCLIENT/ERROR_FILE_ALREADY_EXISTS"))):i&&i.ErrorCode===k.Errors.FileNotFound?(o=!0,f.showError(r.i18n("COREWEBCLIENT/ERROR_FILE_NOT_FOUND"))):f.showError(s.statusText())):(s.path()===this.currentPath()&&s.storageType()===this.storageType()&&this.files.push(s),0===this.uploadingFiles().length&&f.showReport(r.i18n("COREWEBCLIENT/REPORT_UPLOAD_COMPLETE"))),0===this.uploadingFiles().length&&(o=!0)):o=!0,o&&this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern(),!0)}},R.prototype.onFileWithSubfolderUploadComplete=function(e){if(e.sUploadSubFolder){var t=s.compact(e.sUploadSubFolder.split("/"))[0],i=s.find(this.folders(),(function(e){return e.fileName()===t}));i&&i.increaseUploadedFiles()}},R.prototype.onDrop=function(e,t){if(!this.bPublic)if(t&&t.target&&""===this.searchPattern()){var i=n.dataFor(t.target);i&&i instanceof N&&this.dropPath(i.fullPath())}else f.showReport(r.i18n("FILESWEBCLIENT/INFO_CANNOT_UPLOAD_SEARCH_RESULT"))},R.prototype.filesDrop=function(e,t,i){if(!this.bPublic&&this.isDragAllowed()&&t){var s=this.selector.listCheckedAndSelected(),o=this.needToCopyDraggedItems()?"Copy":"Move";this.moveItems(o,e,s)&&l.uiDropHelperAnim(t,i)}},R.prototype.moveItems=function(e,t,i){if(this.bPublic)return!1;var o="",n="",a=!0,l=t instanceof N?t.fullPath():"",h=[],c=t?t instanceof N?t.storageType():t.type:this.storageType(),u=this.getStorageByType(c),p=this.currentStorage(),d=u.type===p.type,m=this.used(),f=this.quota();if(d||!d&&!u.isExternal&&!p.isExternal&&k.FileStorageType.Shared!==u.type){if(u.type===k.FileStorageType.Personal&&p.type!==k.FileStorageType.Personal&&!s.every(i,(function(e){if(e instanceof D){if(f>0&&m+e.size()>f)return!1;m+=e.size()}return!0})))return g.showPopup(E,[r.i18n("FILESWEBCLIENT/ERROR_CANT_MOVE_FILES_QUOTA_PLURAL",{},"",i.length)]),!1;if(s.each(i,s.bind((function(t){(""!==o&&o!==t.path()||""!==n&&n!==t.storageType())&&(a=!1),o=t.path(),n=t.storageType(),t instanceof N&&l===o+"/"+t.id()||("Move"===e&&(t instanceof D?this.deleteFileByName(t.id()):this.deleteFolderByName(t.fileName())),h.push({FromType:n,FromPath:o,Name:t.id(),IsFolder:t instanceof N}))}),this)),h.length>0)return a||(n="",o=""),I.send(e,{FromType:n,ToType:c,FromPath:o,ToPath:l,Files:h},this.onMoveResponse,this),t instanceof N&&t.recivedAnim(!0),!0}return!1},R.prototype.onMoveResponse=function(e,t){e.Result?this.storageType()===t.Parameters.ToType&&this.currentPath()===t.Parameters.ToPath?this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern()):this.getQuota():(e.ErrorCode===k.Errors.CanNotUploadFileQuota?g.showPopup(E,[r.i18n("FILESWEBCLIENT/ERROR_CANT_MOVE_FILES_QUOTA_PLURAL",{},"",t.Parameters.Files.length)]):h.showErrorByCode(e,r.i18n("FILESWEBCLIENT/ERROR_FILES_MOVE_PLURAL",{},"",t.Parameters.Files.length)),this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern()))},R.prototype.dragAndDropHelper=function(e,t){if(!e||!e.allowDrag())return o("<span></span>");if(e.checked(!0),this.needToCopyDraggedItems(t),!this.isDragAllowed())return o("<span></span>");var i=l.draggableItems(),n=this.selector.listCheckedAndSelected(),a=s.countBy(n,(function(e){return e.IS_FILE?"file":"folder"})),h=t?"+ ":"",c="";return c=a.file?a.folder?r.i18n("FILESWEBCLIENT/LABEL_DRAG_ITEMS_PLURAL",{COUNT:h+n.length},null,n.length):r.i18n("FILESWEBCLIENT/LABEL_DRAG_FILES_PLURAL",{COUNT:h+a.file},null,a.file):r.i18n("FILESWEBCLIENT/LABEL_DRAG_FOLDERS_PLURAL",{COUNT:h+a.folder},null,a.folder),o(".count-text",i).text(c),i},R.prototype.onItemDelete=function(){this.isDeleteAllowed()&&this.executeDelete()},R.prototype.onItemSelect=function(e){c.isMobile()&&e instanceof N&&this.onItemDblClick(e)},R.prototype.onEnter=function(e){this.onItemDblClick(e)},R.prototype.onItemDblClick=function(e){if(e){var t=e.getMainAction();switch(t){case"view":e instanceof D&&(this.onSelectClickPopupBound?this.onSelectClickPopupBound():e.executeAction(t));break;case"list":e instanceof N&&e.isIncomplete()||this.routeFiles(e.storageType(),e.fullPath())}}},R.prototype.onGetFilesResponse=function(e,t){var i=e.Result,o=t.Parameters;if(this.bNotLoading=!1,(o.Type===this.storageType()||o.Hash===w.PublicHash)&&o.Path===this.currentPath())if(i){var n=[],a=[];if(s.each(i.Items,(function(e){if(e.IsFolder){var t=new N(this);t.parse(e),this.checkIfFolderUploading(t),n.push(t)}else{var i=new D(e,this);i.oExtendedProps&&i.oExtendedProps.Loading&&(i.uploadError(!0),i.statusText(r.i18n("COREWEBCLIENT/LABEL_FILE_LOADING"))),i.index(a.length),a.push(i)}}),this),s.each(this.files(),(function(e,t,i){if(e.downloading()){var o=s.findIndex(a,(function(t){return e.fileName()===t.fileName()}));-1!==o&&(i[t].index(a[o].index()),a[o]=i[t])}})),this.folders(n),this.files(a),this.newSearchPattern(o.Pattern||""),this.searchPattern(o.Pattern||""),this.loadedFiles(!0),clearTimeout(this.timerId),this.parseQuota(i.Quota),s.isArray(i.Path)&&(this.pathItems.removeAll(),s.each(i.Path.reverse(),s.bind((function(e){var t=new N(this);t.parse(e),this.pathItems.push(t)}),this))),this.loading(!1),i.Access&&this.pathItems().length>0){const e=this.pathItems().length-1,t=this.pathItems()[e];t.oExtendedProps&&t.oExtendedProps.SharedWithMeAccess||(this.pathItems()[e].updateExtendedProps({SharedWithMeAccess:i.Access}),this.pathItems.valueHasMutated())}}else e.ErrorCode!==k.Errors.NotDisplayedError&&(this.loading(!1),this.error(!0),h.showErrorByCode(e,r.i18n("FILESWEBCLIENT/ERROR_FILES_NOT_RECEIVED")))},R.prototype.checkIfFolderUploading=function(e){s.each(this.uploadingFiles(),(function(t){if(t.sUploadSubFolder){var i=s.compact(t.sUploadSubFolder.split("/"))[0];e.fileName()===i&&e.increaseUploadingFiles()}}))},R.prototype.parseQuota=function(e){e&&(this.quota(a.pInt(e.Limit)),this.used(a.pInt(e.Used)))},R.prototype.onDeleteResponse=function(e,t){e.Result?(this.expungeFileItems(),this.getQuota()):(h.showErrorByCode(e),this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern()))},R.prototype.executeRename=function(){var e=s.first(this.selector.listCheckedAndSelected()),t=w.EditFileNameWithoutExtension&&e instanceof D,i=t?l.getFileNameWithoutExtension(e.fileName()):e.fileName(),o=t?l.getFileExtension(e.fileName()):"";!this.bPublic&&e&&g.showPopup(P,[i,s.bind(this.renameItem,this,o)])},R.prototype.renameItem=function(e,t){var i=""===e?t:t+"."+e,o=s.first(this.selector.listCheckedAndSelected());return l.validateFileOrFolderName(i)?(I.send("Rename",{Type:o.storageType(),Path:o.path(),Name:o.id()||o.fileName(),NewName:i,IsLink:o.bIsLink,IsFolder:!o.IS_FILE},this.onRenameResponse,this),""):o instanceof N?r.i18n("FILESWEBCLIENT/ERROR_INVALID_FOLDER_NAME"):r.i18n("FILESWEBCLIENT/ERROR_INVALID_FILE_NAME")},R.prototype.getFileIfOnlyOneSelected=function(){var e=this.selector.listCheckedAndSelected();return 1===e.length&&e[0]instanceof D?e[0]:null},R.prototype.executeDownload=function(){var e=this.getFileIfOnlyOneSelected();e&&e.executeAction("download")},R.prototype.createPublicLink=function(){var e=s.first(this.selector.listCheckedAndSelected());!this.bPublic&&e&&g.showPopup(T,[e])},R.prototype.executeSend=function(){var e=s.map(this.selectedFiles(),(function(e){return{Storage:e.storageType(),Path:e.path(),Name:e.id()||e.fileName()}}));this.bAllowSendEmails&&e.length>0&&I.send("SaveFilesAsTempFiles",{Files:e},(function(e){e.Result&&L(e.Result)}),this)},R.prototype.onShareIconClick=function(e){e&&g.showPopup(T,[e])},R.prototype.onSecureIconClick=function(e){e&&s.isFunction(e.onSecureIconClick)&&e.onSecureIconClick(e)},R.prototype.onFileShareIconClick=function(e){C&&e&&g.showPopup(C,[e,this.expungeFileItems.bind(this)])},R.prototype.onRenameResponse=function(e,t){e.Result||h.showErrorByCode(e,r.i18n("FILESWEBCLIENT/ERROR_FILE_RENAME")),this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern(),!0)},R.prototype.refresh=function(){this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern(),!0)},R.prototype.executeDelete=function(){var e=this.sharedParentFolder(),t=!!e&&e.sharedWithMeAccessWrite(),i=this.selector.listCheckedAndSelected()||[],o=t?i:this.selectedOwnItems(),n=o.length;if(!this.bPublic&&n>0){var a=i.length!==n,l=!!s.find(o,(function(e){return!e.IS_FILE})),h=!!s.find(o,(function(e){return e.IS_FILE})),c="";c=a?r.i18n("FILESWEBCLIENT/CONFIRM_NOT_ALL_ITEMS_OWN"):l&&h?r.i18n("FILESWEBCLIENT/CONFIRM_DELETE_ITEMS_PLURAL",{COUNT:n},null,n):l?r.i18n("FILESWEBCLIENT/CONFIRM_DELETE_FOLDERS_PLURAL",{COUNT:n},null,n):r.i18n("FILESWEBCLIENT/CONFIRM_DELETE_FILES_PLURAL",{COUNT:n},null,n),this.selector.useKeyboardKeys(!1),g.showPopup(S,[c,s.bind(this.deleteItems,this,o),"",r.i18n("COREWEBCLIENT/ACTION_DELETE")])}},R.prototype.onShow=function(){this.loaded(!0),this.bPublic||this.requestStorages(),this.selector.useKeyboardKeys(!0),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!0)},R.prototype.onHide=function(){this.selector.useKeyboardKeys(!1),this.oJua&&this.oJua.setDragAndDropEnabledStatus(!1)},R.prototype.getQuota=function(){I.send("GetQuota",{Type:this.storageType()},(function(e){e.Result&&this.parseQuota(e.Result)}),this)},R.prototype.getStorageByType=function(e){return s.find(this.storages(),(function(t){return t.type===e}))},R.prototype.requestStorages=function(){I.send("GetStorages",null,this.onGetStoragesResponse,this)},R.prototype.onGetStoragesResponse=function(e,t){var i=e.Result;i&&(s.each(i,(function(e){e.Type&&!this.getStorageByType(e.Type)&&this.storages.push({isExternal:e.IsExternal,type:e.Type,displayName:e.DisplayName,droppable:n.computed((function(){return e.IsDroppable&&(!this.sharedParentFolder()||this.needToCopyDraggedItems()||this.sharedParentFolder()&&this.sharedParentFolder().sharedWithMeAccessWrite())}),this)})}),this),this.expungeExternalStorages(s.map(i,(function(e){return e.Type}),this))),this.currentStorage()||(this.storageType(k.FileStorageType.Personal),this.pathItems.removeAll()),this.bInPopup&&this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern(),!0)},R.prototype.clearAndShowLoading=function(){this.folders([]),this.files([]),this.loading(!0)},R.prototype.currentGetFiles=function(){var e=this.pathItems().length,t={Type:this.storageType(),Path:this.currentPath(),Pattern:this.searchPattern(),PathRequired:""!==this.currentPath()&&0===e};I.send("GetFiles",t,this.onGetFilesResponse,this)},R.prototype.routeFiles=function(e,t,i,s){if(!this.disableRoute){this.bPublic?m.setHash(A.getFiles("",t,""))&&(this.clearAndShowLoading(),I.send("GetPublicFiles",{Hash:w.PublicHash,Path:this.currentPath()},this.onGetFilesResponse,this)):(this.bNotLoading=s,this.bInPopup?this.onUserRoute(A.getParsedParams(e,t,i)):m.setHash(A.getFiles(e,t,i))&&(this.clearAndShowLoading(),this.currentGetFiles()))}},R.prototype.addPathItems=function(e,t,i){var s=new N(this);s.storageType(e),s.fileName(i),s.path(t),s.fullPath(t),this.pathItems.unshift(s)},R.prototype.onRoute=function(e){var t=A.parseFiles(e);this.bPublic?this.onPublicRoute(t):this.onUserRoute(t)},R.prototype.onUserRoute=function(e){var t=0===this.storages().length||!!s.find(this.storages(),(function(t){return t.type===e.Storage}))?e.Storage:this.storages().length>0?this.storages()[0].type:"",i=e.Path;this.error(!1),this.storageType(t),this.currentPath(i),this.searchPattern(a.pString(e.Search)),this.loadedFiles(!1),this.populatePathItems(e),this.bNotLoading&&(this.files().length>0||this.folders().length>0)?this.timerId=setTimeout(s.bind((function(){this.loadedFiles()||this.error()||this.clearAndShowLoading()}),this),3e3):this.clearAndShowLoading(),this.currentGetFiles()},R.prototype.populatePathItems=function(e){var t=this.currentPath(),i=e.PathParts.reverse(),o=s.find(this.folders(),(function(e){return e.fullPath()===t})),n=s.findIndex(this.pathItems(),(function(e){return e.fullPath()===t}));if(-1!==n)this.pathItems(this.pathItems().slice(0,n+1));else if(o)this.pathItems.push(o);else if("google"!==this.storageType()||""===t){this.pathItems.removeAll(),s.each(i,s.bind((function(e){var i=t.lastIndexOf(e);this.addPathItems(this.storageType(),t,e),t=t.substr(0,i)}),this));var r={Type:this.storageType(),Path:this.currentPath()};I.send("GetAccessInfoForPath",r,(function(e){e&&e.Result&&(s.each(this.pathItems(),(function(t){var i=t.fullPath();"/"===i.substr(i.length-1,1)&&(i=i.substr(0,i.length-1)),e.Result[i]&&t.updateExtendedProps({SharedWithMeAccess:e.Result[i]})})),this.pathItems.valueHasMutated())}),this)}},R.prototype.onPublicRoute=function(e){var t=e.Path,i=e.PathParts.reverse(),o="";this.currentPath(t),this.pathItems.removeAll(),s.each(i,s.bind((function(i){var s=t.lastIndexOf(i);this.addPathItems(e.Storage,t,i),t=t.substr(0,s),o=i}),this)),o!==this.rootPath()&&this.addPathItems(e.Storage,"",this.rootPath()),this.clearAndShowLoading(),I.send("GetPublicFiles",{Hash:w.PublicHash,Path:this.currentPath()},this.onGetFilesResponse,this)},R.prototype.deleteItems=function(e,t,i="Delete"){var o=this.storageType(),n=this.currentPath();if(t&&0<e.length){var r=s.compact(s.map(e,(function(e){return""!==e.id()?(e.deleted(!0),o=e.storageType(),{Path:e.path(),Name:e.id(),IsFolder:!e.IS_FILE}):null})));r.length&&I.send(i,{Type:o,Path:n,Items:r},this.onDeleteResponse,this)}},R.prototype.getFileByName=function(e){return s.find(this.files(),(function(t){return t.fileName()===e}))},R.prototype.addFileToCurrentFolder=function(e){""===this.searchPattern()&&this.files.push(e)},R.prototype.deleteFileByName=function(e){this.files(s.filter(this.files(),(function(t){return t.id()!==e})))},R.prototype.deleteFolderByName=function(e){this.folders(s.filter(this.folders(),(function(t){return t.fileName()!==e})))},R.prototype.expungeFileItems=function(){this.folders(s.filter(this.folders(),(function(e){return!e.deleted()}),this)),this.files(s.filter(this.files(),(function(e){return!e.deleted()}),this))},R.prototype.expungeExternalStorages=function(e){this.storages(s.filter(this.storages(),(function(t){return!t.isExternal||s.include(e,t.type)}),this))},R.prototype.getUploadFileByUid=function(e){return s.find(this.uploadingFiles(),(function(t){return t.uploadUid()===e}))},R.prototype.deleteUploadFileByUid=function(e){this.uploadingFiles(s.filter(this.uploadingFiles(),(function(t){return t.uploadUid()!==e})))},R.prototype.getUploadingFiles=function(){return s.filter(this.uploadingFiles(),s.bind((function(e){return e.path()===this.currentPath()&&e.storageType()===this.storageType()}),this))},R.prototype.onCancelUpload=function(e){this.deleteUploadFileByUid(e),this.oJua&&this.oJua.cancel(e)},R.prototype.onCreateFolderResponse=function(e,t){e.Result||h.showErrorByCode(e),this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern(),!0)},R.prototype.createFolder=function(e){return e=o.trim(e),l.validateFileOrFolderName(e)?(I.send("CreateFolder",{Type:this.storageType(),Path:this.currentPath(),FolderName:e},this.onCreateFolderResponse,this),""):r.i18n("FILESWEBCLIENT/ERROR_INVALID_FOLDER_NAME")},R.prototype.executeCreateFolder=function(){g.showPopup(F,[s.bind(this.createFolder,this)])},R.prototype.onCreateLinkResponse=function(e,t){this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern(),!0)},R.prototype.createLink=function(e){I.send("CreateLink",{Type:this.storageType(),Path:this.currentPath(),Link:e.sLinkUrl,Name:e.fileName()},this.onCreateLinkResponse,this)},R.prototype.executeCreateShortcut=function(){var e=s.bind(this.createLink,this);g.showPopup(v,[e])},R.prototype.onSearch=function(){this.routeFiles(this.storageType(),this.currentPath(),this.newSearchPattern())},R.prototype.clearSearch=function(){this.routeFiles(this.storageType(),this.currentPath())},R.prototype.getCurrentFolder=function(){var e=new N(this);return e.fullPath(this.currentPath()),e.storageType(this.storageType()),e},R.prototype.registerToolbarButtons=function(e){a.isNonEmptyArray(e)&&(s.each(e,s.bind((function(e){s.isFunction(e.useFilesViewData)&&e.useFilesViewData(this)}),this)),this.addToolbarButtons(s.union(this.addToolbarButtons(),e)))},R.prototype.onFileRemove=function(e,t){var i=s.bind((function(e,t){var i={Type:this.storageType(),Path:this.currentPath(),Items:[{Path:this.currentPath(),Name:t,IsFolder:!1}]};I.send("Delete",i,(function(e){e.Result||h.showErrorByCode(e),this.currentGetFiles()}),this),this.onCancelUpload(e)}),this);if(t.downloading())c.broadcastEvent("CFilesView::FileDownloadCancel",{oFile:t});else if(!t.uploaded()&&e){c.broadcastEvent("CFilesView::FileUploadCancel",{sFileUploadUid:e,sFileUploadName:t.fileName(),fOnUploadCancelCallback:i})||i(e,t.fileName())}},e.exports=R},kwPS:function(e,t,i){"use strict";var s=i("xG9w"),o=i("EVdn"),n=i("0h2I"),r=i("AFLV"),a=i("Yjhd"),l=i("IAk5"),h=i("HLSX"),c=i("76Kh");function u(e,t,i,a,h,c,u,p,d,m,f){this.active=n.observable(!1),this.fSelectCallback=t||function(){},this.fDeleteCallback=i||function(){},this.fDblClickCallback=!l.isMobile()&&a?a:function(){},this.fEnterCallback=h||function(){},this.bResetCheckedOnClick=!!u,this.bCheckOnSelect=!!p,this.bUnselectOnCtrl=!!d,this.bDisableMultiplySelection=!!m,this.bChangeOnSelect=void 0===f||!!f,this.useKeyboardKeys=n.observable(!1),this.list=n.observableArray([]),e&&e.subscribe&&e.subscribe((function(e){this.list(e)}),this),this.multiplyLineFactor=c,this.oLast=null,this.oListScope=null,this.oScrollScope=null,this.iTimer=0,this.iFactor=1,this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Up,this.KeyRight=Enums.Key.Down,this.multiplyLineFactor&&(this.multiplyLineFactor.subscribe?this.multiplyLineFactor.subscribe((function(e){this.iFactor=0<e?e:1}),this):this.iFactor=r.pInt(this.multiplyLineFactor),this.KeyUp=Enums.Key.Up,this.KeyDown=Enums.Key.Down,this.KeyLeft=Enums.Key.Left,this.KeyRight=Enums.Key.Right,o("html").hasClass("rtl")&&(this.KeyLeft=Enums.Key.Right,this.KeyRight=Enums.Key.Left)),this.sActionSelector="",this.sSelectableSelector="",this.sCheckboxSelector="";var b=this;this.listChecked=n.computed({read:function(){return s.filter(this.list(),(function(e){var t=e&&e.checked&&e.checked(),i=e&&e.selected&&e.selected();return t||b.bCheckOnSelect&&i}))},write:function(e){e=!!e,s.each(this.list(),(function(t){t.checked(e)})),this.list.valueHasMutated()},owner:this}),this.checkAll=n.computed({read:function(){return 0<this.listChecked().length},write:function(e){this.listChecked(!!e)},owner:this}),this.selectorHook=n.observable(null),this.selectorHook.subscribe((function(){this.active()&&this.selectorHook()&&this.selectorHook().selected(!1)}),this,"beforeChange"),this.selectorHook.subscribe((function(){this.active()&&this.selectorHook()&&this.selectorHook().selected(!0)}),this),this.itemSelected=n.computed({read:this.selectorHook,write:function(e){this.selectorHook(e),e&&(b.scrollToSelected(),this.oLast=e)},owner:this}),this.list.subscribe((function(e){const t=this.itemSelected();if(Array.isArray(e)&&t){!!e.find(e=>"function"==typeof t.isEqual?t.isEqual(e):t===e)||this.itemSelected(null)}else this.itemSelected(null)}),this),this.listCheckedOrSelected=n.computed({read:function(){var e=this.itemSelected(),t=this.listChecked();return 0<t.length?t:e?[e]:[]},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.listCheckedAndSelected=n.computed({read:function(){var e=[],t=this.itemSelected(),i=this.listChecked();return i&&(e=i.slice(0)),t&&-1===s.indexOf(i,t)&&e.push(t),e},write:function(e){e?this.listChecked(!0):(this.itemSelected(null),this.listChecked(!1))},owner:this}),this.isIncompleteChecked=n.computed((function(){var e=this.list().length,t=this.listChecked().length;return 0<e&&0<t&&e>t}),this),this.onKeydownBound=s.bind(this.onKeydown,this)}u.prototype.iTimer=0,u.prototype.bResetCheckedOnClick=!1,u.prototype.bCheckOnSelect=!1,u.prototype.bUnselectOnCtrl=!1,u.prototype.bDisableMultiplySelection=!1,u.prototype.getLastOrSelected=function(){var e=0,t=null;return s.each(this.list(),(function(i){i&&s.isFunction(i.checked)&&(i.checked()&&e++,i.selected()&&(t=i))})),0===e&&t?t:this.oLast},u.prototype.unbind=function(){this.active(!1),this.itemSelected()&&this.itemSelected().selected(!1),o(document).off("keydown",this.onKeydownBound),o(this.oListScope).off()},u.prototype.initOnApplyBindings=function(e,t,i,s,r){this.active(!0),o(document).on("keydown",this.onKeydownBound),this.oListScope=s,this.oScrollScope=r,this.sActionSelector=e,this.sSelectableSelector=t,this.sCheckboxSelector=i;var a=this,l=function(e,t,i){var s=0,o=0,n=null,r=!1,l=!1,h=[],c=!1;if(t=t||null,i&&i.shiftKey&&null!==t&&null!==e&&t!==e)for(h=a.list(),c=t.checked(),s=0,o=h.length;s<o;s++)r=!1,(n=h[s])!==e&&n!==t||(r=!0),r&&(l=!l),(l||r)&&n&&n.checked&&n.checked(c);t&&(a.oLast=t)};o(this.oListScope).on("dblclick",e,(function(e){var t=n.dataFor(this);!t||!e||e.ctrlKey||e.altKey||e.shiftKey||a.onDblClick(t)})),h.mobileDevice&&o(this.oListScope).on("touchstart",e,(function(e){if(e){var t=e.timeStamp,i=t-(o(this).data("lastTouch")||t),s=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches.length:0;o(this).data("lastTouch",t),!i||i>250||s>1||(e.preventDefault(),o(this).trigger("dblclick"))}})),o(this.oListScope).on("click",e,(function(e){var t=!0,i=null,s=a.getLastOrSelected(),o=n.dataFor(this);o&&e&&(e.shiftKey?(t=!1,a.bDisableMultiplySelection||(null===a.oLast&&(a.oLast=o),o.checked(!o.checked()),l(s,o,e))):(e.ctrlKey||e.metaKey)&&(t=!1,a.bDisableMultiplySelection||(a.oLast=o,!(i=a.itemSelected())||i.checked()||o.checked()||i.checked(!0),a.bUnselectOnCtrl&&o===a.itemSelected()?(o.checked(!o.selected()),a.itemSelected(null)):o.checked(!o.checked()))),t&&a.selectionFunc(o))})),o(this.oListScope).on("click",i,(function(e){var t=n.dataFor(this);t&&e&&!a.bDisableMultiplySelection&&(e.shiftKey?(null===a.oLast&&(a.oLast=t),l(a.getLastOrSelected(),t,e)):a.oLast=t),e&&e.stopPropagation&&e.stopPropagation()})),o(this.oListScope).on("dblclick",i,(function(e){e&&e.stopPropagation&&e.stopPropagation()}))},u.prototype.getResultSelection=function(e,t){var i=this,n=!1,r=!1,a=null,l=this.iFactor,h=!!this.multiplyLineFactor,c=0,u=0,p=[];if(!e&&-1<o.inArray(t,[this.KeyUp,this.KeyDown,this.KeyLeft,this.KeyRight,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]))(p=this.list())&&0<p.length&&(-1<o.inArray(t,[this.KeyDown,this.KeyRight,Enums.Key.PageUp,Enums.Key.Home])?a=p[0]:-1<o.inArray(t,[this.KeyUp,this.KeyLeft,Enums.Key.PageDown,Enums.Key.End])&&(a=p[p.length-1]));else if(e&&0<(u=(p=this.list())?p.length:0))if(Enums.Key.Home===t||Enums.Key.PageUp===t||Enums.Key.End===t||Enums.Key.PageDown===t||h&&(Enums.Key.Left===t||Enums.Key.Right===t)||!h&&(Enums.Key.Up===t||Enums.Key.Down===t))s.each(p,(function(s){if(!n)switch(t){case i.KeyUp:case i.KeyLeft:e===s?n=!0:a=s;break;case Enums.Key.Home:case Enums.Key.PageUp:a=s,n=!0;break;case i.KeyDown:case i.KeyRight:r?(a=s,n=!0):e===s&&(r=!0);break;case Enums.Key.End:case Enums.Key.PageDown:a=s}}));else if(h&&this.KeyDown===t){for(;c<u;c++)if(e===p[c]){u-1<(c+=l)&&(c-=l),a=p[c];break}}else if(h&&this.KeyUp===t)for(c=u;c>=0;c--)if(e===p[c]){0>(c-=l)&&(c+=l),a=p[c];break}return a},u.prototype.shiftClickResult=function(e,t,i){if(t){var n=!!this.multiplyLineFactor,r=!1,a=!1;-1<o.inArray(i,n?[Enums.Key.Left,Enums.Key.Right]:[Enums.Key.Up,Enums.Key.Down])?t.checked(!t.checked()):-1<o.inArray(i,n?[Enums.Key.Up,Enums.Key.Down,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End]:[Enums.Key.Left,Enums.Key.Right,Enums.Key.PageUp,Enums.Key.PageDown,Enums.Key.Home,Enums.Key.End])&&(a=!t.checked(),s.each(this.list(),(function(i){var s=!1;i!==e&&t!==i||(r=!r,s=!0),(r||s)&&(i.checked(a),s=!1)})),n&&e&&(i===Enums.Key.Up||i===Enums.Key.Down)&&e.checked(!e.checked()))}},u.prototype.clickNewSelectPosition=function(e,t){var i=this.itemSelected(),s=this.getResultSelection(i,e);s&&(t&&this.shiftClickResult(s,i,e),this.selectionFunc(s))},u.prototype.onKeydown=function(e){var t=!0,i=0;return this.useKeyboardKeys()&&e&&!a.isTextFieldFocused()&&!c.hasOpenedMaximizedPopups()&&(i=e.keyCode,e.ctrlKey||this.KeyUp!==i&&this.KeyDown!==i&&this.KeyLeft!==i&&this.KeyRight!==i&&Enums.Key.PageUp!==i&&Enums.Key.PageDown!==i&&Enums.Key.Home!==i&&Enums.Key.End!==i?Enums.Key.Del!==i||e.ctrlKey||e.shiftKey?Enums.Key.Enter===i?0<this.list().length&&!e.ctrlKey&&(this.onEnter(this.itemSelected()),t=!1):!e.ctrlKey||e.altKey||e.shiftKey||Enums.Key.a!==i||(this.checkAll(!(this.checkAll()&&!this.isIncompleteChecked())),t=!1):0<this.list().length&&(this.onDelete(),t=!1):(this.clickNewSelectPosition(i,e.shiftKey),t=!1)),t},u.prototype.onDelete=function(){this.fDeleteCallback.call(this,this.listCheckedOrSelected())},u.prototype.onEnter=function(e){e&&this.fEnterCallback.call(this,e)},u.prototype.selectionFunc=function(e){this.bChangeOnSelect&&this.itemSelected(null),this.bResetCheckedOnClick&&this.listChecked(!1),this.bChangeOnSelect&&this.itemSelected(e),this.fSelectCallback.call(this,e)},u.prototype.onDblClick=function(e){this.fDblClickCallback.call(this,e)},u.prototype.koCheckAll=function(){return n.computed({read:this.checkAll,write:this.checkAll,owner:this})},u.prototype.koCheckAllIncomplete=function(){return n.computed({read:this.isIncompleteChecked,write:this.isIncompleteChecked,owner:this})},u.prototype.scrollToSelected=function(){if(!(this.oListScope&&this.oScrollScope&&this.oScrollScope[0]&&this.oScrollScope[0].isConnected))return!1;var e=o(this.sSelectableSelector,this.oScrollScope),t=e[0]?e[0].offsetTop:void 0,i=this.oScrollScope.height(),s=this.oScrollScope.scrollTop(),n=e.outerHeight();return!(t&&t>=s&&t<=s+i-n)&&(t<s+i&&t+n>s+i?this.oScrollScope.scrollTop(t+n+20-i):this.oScrollScope.scrollTop(t-20),!0)},e.exports=u},mjrp:function(e,t,i){"use strict";var s=i("EVdn"),o=i("xG9w"),n=i("0h2I"),r=i("w+bY"),a=i("RN+F"),l=i("AFLV"),h=i("IAk5"),c=i("hPb3"),u=i("76Kh"),p=i("1grR"),d=c.MultipleFilesUploadLimit;function m(e){return void 0===e}function f(e){0<e&&clearTimeout(e),e=0}function b(e){return(e=e&&(e.originalEvent?e.originalEvent:e)||window.event).dataTransfer?e:null}function y(e,t,i){return e&&t&&!m(e[t])?e[t]:i}function g(e,t,i){e[t]=i}function E(){return"jua-uid-"+function(e){var t="",i="0123456789abcdefghijklmnopqrstuvwxyz";for(e=m(e)?32:l.pInt(e);t.length<e;)t+=i.substr(Math.round(Math.random()*i.length),1);return t}(16)+"-"+(new Date).getTime().toString()}function S(e,t){return{FileName:m(e.fileName)?m(e.name)?null:e.name:e.fileName,Size:m(e.fileSize)?m(e.size)?null:e.size:e.fileSize,Type:m(e.type)?null:e.type,Folder:m(t)?"":t,File:e}}function F(e,t,i,s,o,n){var r=0,a=0,h=0,c=null,u=null,p=!1,f=!1,b=function(e,t,i,a){if(e&&!m(e.name))if(t=t||"",e.isFile)e.file((function(e){!p||0<=--o?i(S(e,t)):p&&!f&&0>o&&n&&(f=!0,n(r))}));else if(s&&e.isDirectory&&e.createReader){var h=e.createReader(),c=0,u=0;h&&h.readEntries&&h.readEntries((function(s){if(s&&l.isNonEmptyArray(s))for(c=0,u=s.length;c<u;c++)b(s[c],t+e.name+"/",i,a)}))}};if(s=!!m(s)||!!s,i=!m(i)&&!!i,o=m(o)?d:l.pInt(o),r=o,p=0<o,e=e&&0<e.length?e:null)for(h=0,a=e.length;h<a;h++)(c=e[h])&&(i?"file"===c.kind&&c.webkitGetAsEntry&&(u=c.webkitGetAsEntry())&&b(u,"",t,n):!p||0<=--o?t(S(c)):p&&!f&&0>o&&n&&(f=!0,n(r)))}function v(e,t,i,s){var o=e&&e.files&&0<e.files.length?e.files:null;o?F(o,t,!1,!1,i,s):t({FileName:e.value.split("\\").pop().split("/").pop(),Size:null,Type:null,Folder:"",File:null})}function P(e){var t=!1;if(e&&e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.length)for(var i=0,s=e.dataTransfer.types.length;i<s;i++)if("files"===e.dataTransfer.types[i].toLowerCase()){t=!0;break}return t}function T(){return s('<label style="position: absolute; background-color:#fff; right: 0px; top: 0px; left: 0px; bottom: 0px; margin: 0px; padding: 0px; cursor: pointer;"></label>').css({opacity:0})}function C(e,t,i,o){e=m(e)?"":e.toString();var n=function(e,t){return""!==t&&(t=' accept="'+t+'"'),s('<input type="file" tabindex="-1" hidefocus="hidefocus" style="position: absolute; '+e+': -9999px;"'+t+" />")}(i=m(i)?"left":i.toString(),o=m(o)?"":o.toString());return 0<e.length&&n.attr("name",e),(m(t)||t)&&n.prop("multiple",!0),n}function L(e,t){return l.pString(o.isFunction(e)?e.apply(null,o.isArray(t)?t:[]):e)}function A(e,t){this.oXhrs={},this.oUids={},this.oJua=e,this.oOptions=t}function I(e,t){this.oUids={},this.oForms={},this.oJua=e,this.oOptions=t}function w(e){e=m(e)?{}:e;var t=this;t.bEnableDnD=!0,t.bEnableButton=!0,t.oEvents={onDialog:null,onSelect:null,onStart:null,onComplete:null,onCompleteAll:null,onProgress:null,onDragEnter:null,onDragLeave:null,onDrop:null,onBodyDragEnter:null,onBodyDragLeave:null,onLimitReached:function(){u.showPopup(p,[a.i18n("COREWEBCLIENT/ERROR_UPLOAD_NUMBER_LIMIT_PLURAL",{NUMBERLIMIT:d},null,d)])}},t.oOptions=o.extend({action:"",name:"",hidden:{},queueSize:10,clickElement:!1,dragAndDropElement:!1,dragAndDropBodyElement:!1,disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!1,disableMultiple:!1,disableDocumentDropPrevent:!1,disableAutoUploadOnDrop:!1,multipleSizeLimit:d,hiddenElementsPosition:"left"},e),t.oQueue=r(l.pInt(y(t.oOptions,"queueSize",10))),t.runEvent("onCompleteAll")&&t.oQueue.await((function(){t.runEvent("onCompleteAll")})),t.oDriver=t.isAjaxUploaderSupported()&&!y(t.oOptions,"disableAjaxUpload",!1)?new A(t,t.oOptions):new I(t,t.oOptions),t.oClickElement=y(t.oOptions,"clickElement",null),t.oClickElement&&(s(t.oClickElement).css({position:"relative",overflow:"hidden"}),"inline"===s(this.oClickElement).css("display")&&s(this.oClickElement).css("display","inline-block"),this.oDriver.generateNewInput(this.oClickElement)),this.oDriver.isDragAndDropSupported()&&y(this.oOptions,"dragAndDropElement",!1)&&!y(this.oOptions,"disableAjaxUpload",!1)?function(e){var t=s(document),i=s(y(e.oOptions,"dragAndDropBodyElement",!1)||t),o=y(e.oOptions,"dragAndDropElement",!1);o&&(y(e.oOptions,"disableDocumentDropPrevent",!1)||t.on("dragover",(function(t){if(e.bEnableDnD&&t&&(t=b(t))&&t.dataTransfer&&P(t))try{t.dataTransfer.dropEffect="none",t.preventDefault()}catch(e){}})),i&&i[0]&&i.on("dragover",(function(t){e.bEnableDnD&&t&&f(e.iDocTimer)})).on("dragenter",(function(t){e.bEnableDnD&&t&&(t=b(t))&&P(t)&&(f(e.iDocTimer),t.preventDefault(),e.runEvent("onBodyDragEnter",[t]))})).on("dragleave",(function(t){e.bEnableDnD&&t&&(t=b(t))&&(f(e.iDocTimer),e.iDocTimer=setTimeout((function(){e.runEvent("onBodyDragLeave",[t])}),200))})).on("drop",(function(t){if(e.bEnableDnD&&t&&(t=b(t))){var i=P(t);return i&&t.preventDefault(),e.runEvent("onBodyDragLeave",[t]),!i}return!1})),s(o).bind("dragenter",(function(t){e.bEnableDnD&&t&&(t=b(t))&&P(t)&&(f(e.iDocTimer),t.preventDefault(),e.runEvent("onDragEnter",[o,t]))})).bind("dragover",(function(t){if(e.bEnableDnD&&t&&(t=b(t))&&t.dataTransfer&&P(t))try{var s=t.dataTransfer.effectAllowed;f(e.iDocTimer),t.dataTransfer.dropEffect="move"===s||"linkMove"===s?"move":"copy",t.stopPropagation(),t.preventDefault(),i.trigger("dragover",t)}catch(e){}})).bind("dragleave",(function(t){if(e.bEnableDnD&&t){if(t=b(t)){var i=document.elementFromPoint?document.elementFromPoint(t.clientX,t.clientY):null;if(i&&(n=i,r=!1,(s=this)&&n&&(r=s===n||(s.contains?s.contains(n):!!n.compareDocumentPosition&&!!(8&n.compareDocumentPosition(s)))),r))return;f(e.iDocTimer),e.runEvent("onDragLeave",[o,t])}}else var s,n,r})).bind("drop",(function(t){e.bEnableDnD&&t&&(t=b(t))&&P(t)&&(t.preventDefault(),function(e,t,i,s,o){var n=null,r=null;(e=b(e))&&((n=(e.dataTransfer?y(e.dataTransfer,"items",null):null)||y(e,"items",null))&&0<n.length&&n[0]&&n[0].webkitGetAsEntry?F(n,t,!0,o,i,s):P(e)&&(r=y(e,"files",null)||(e.dataTransfer?y(e.dataTransfer,"files",null):null))&&0<r.length&&F(r,t,!1,!1,i,s))}(t,(function(i){i&&(y(e.oOptions,"disableAutoUploadOnDrop",!1)?e.runEvent("onDrop",[i,t,function(){e.addNewFile(i),f(e.iDocTimer)}]):(e.runEvent("onDrop",[i,t]),e.addNewFile(i),f(e.iDocTimer)))}),y(e.oOptions,"multipleSizeLimit",d),e.getEvent("onLimitReached"),!y(e.oOptions,"disableFolderDragAndDrop",!0))),e.runEvent("onDragLeave",[t])})))}(t):t.bEnableDnD=!1,g(t,"on",t.on),g(t,"cancel",t.cancel),g(t,"isDragAndDropSupported",t.isDragAndDropSupported),g(t,"isAjaxUploaderSupported",t.isAjaxUploaderSupported),g(t,"setDragAndDropEnabledStatus",t.setDragAndDropEnabledStatus)}A.prototype.oXhrs={},A.prototype.oUids={},A.prototype.oJua=null,A.prototype.oOptions={},A.prototype.isDragAndDropSupported=function(){return!0},A.prototype.regTaskUid=function(e){this.oUids[e]=!0},A.prototype.uploadTask=function(e,t,i,n,r,a,l){if(!1===this.oUids[e]||!t||!t.File)return n(null,e),!1;try{var h=this,c=new XMLHttpRequest,u=new FormData,p=y(this.oOptions,"action",""),d=o.clone(y(this.oOptions,"hidden",{})),f=this.oJua.getEvent("onStart"),b=this.oJua.getEvent("onComplete"),g=this.oJua.getEvent("onProgress");return c.open("POST",p,!0),c.setRequestHeader("Authorization","Bearer "+s.cookie("AuthToken")),c.setRequestHeader("X-Client","WebClient"),g&&c.upload&&(c.upload.onprogress=function(i){i&&i.lengthComputable&&!m(i.loaded)&&!m(i.total)&&(void 0===l?g(e,i.loaded,i.total):g(e,l+i.loaded>t.Size?t.Size:l+i.loaded,t.Size))}),c.onreadystatechange=function(){if(4===c.readyState&&200===c.status){if(b&&!r){var t=!1,i=null;try{i=s.parseJSON(c.responseText),t=!0}catch(e){i=null}b(e,t,i)}m(h.oXhrs[e])||(h.oXhrs[e]=null),n(a?c.responseText:null,e)}else 4===c.readyState&&(b(e,!1,null),n(null,e))},f&&f(e),u.append("jua-post-type","ajax"),u.append(y(this.oOptions,"name","juaFile"),t.File,t.FileName),i=o.extend(i,t.Hidden||{}),d.Parameters=JSON.stringify(i),s.each(d,(function(e,i){u.append(e,L(i,[t]))})),c.send(u),this.oXhrs[e]=c,!0}catch(e){window.console&&window.console.error(e)}return n(null,e),!1},A.prototype.generateNewInput=function(e){var t=this,i=null,o=null;e&&(o=C("",!y(this.oOptions,"disableMultiple",!1),y(this.oOptions,"hiddenElementsPosition","left"),y(this.oOptions,"accept","")),(i=T()).append(o),s(e).append(i),o.on("click",(function(e){if(t.oJua.bEnableButton){var i=t.oJua.getEvent("onDialog");i&&i()}else e.preventDefault()})).on("change",(function(){v(this,(function(s){t.oJua.addNewFile(s),t.generateNewInput(e),setTimeout((function(){i.remove()}),10)}),y(t.oOptions,"multipleSizeLimit",d),t.oJua.getEvent("onLimitReached"))})))},A.prototype.cancel=function(e){if(this.oUids[e]=!1,this.oXhrs[e]){try{this.oXhrs[e].abort&&this.oXhrs[e].abort()}catch(e){}this.oXhrs[e]=null}},I.prototype.oUids={},I.prototype.oForms={},I.prototype.oJua=null,I.prototype.oOptions={},I.prototype.isDragAndDropSupported=function(){return!1},I.prototype.regTaskUid=function(e){this.oUids[e]=!0},I.prototype.uploadTask=function(e,t,i,n,r,a,l){if(!1===this.oUids[e])return n(null,e),!1;var h=this.oForms[e],c=o.clone(y(this.oOptions,"hidden",{})),u=this.oJua.getEvent("onStart"),p=this.oJua.getEvent("onComplete");return h?(h.append(s('<input type="hidden" />').attr("name","jua-post-type").val("iframe")),i=o.extend(i,t.Hidden||{}),c.Parameters=JSON.stringify(i),s.each(c,(function(e,i){h.append(s('<input type="hidden" />').attr("name",e).val(L(i,[t])))})),h.trigger("submit"),u&&u(e),h.find("iframe").on("load",(function(t){var i=!1,o=null,r={};if(p){try{o=this.contentDocument?this.contentDocument:this.contentWindow.document,r=s.parseJSON(o.body.innerHTML),i=!0}catch(e){r={}}p(e,i,r)}n(null,e),window.setTimeout((function(){h.remove()}),100)}))):n(null,e),!0},I.prototype.generateNewInput=function(e){var t=this,i="",o=null,n=null,r=y(this.oOptions,"action",""),a=null,l=y(this.oOptions,"hiddenElementsPosition","left");e&&(i=E(),o=C(y(this.oOptions,"name","juaFile"),!y(this.oOptions,"disableMultiple",!1),y(this.oOptions,"hiddenElementsPosition","left"),y(this.oOptions,"accept","")),a=s('<form action="'+r+'" target="iframe-'+i+'"  method="POST" enctype="multipart/form-data" style="display: block; cursor: pointer;"></form>'),n=s('<iframe name="iframe-'+i+'" tabindex="-1" src="javascript:void(0);"  style="position: absolute; top: -1000px; '+l+': -1000px; cursor: pointer;" />').css({opacity:0}),a.append(T().append(o)).append(n),s(e).append(a),this.oForms[i]=a,o.on("click",(function(e){if(t.oJua.bEnableButton){var i=t.oJua.getEvent("onDialog");i&&i()}else e.preventDefault()})).on("change",(function(){v(this,(function(s){if(s){var o=y(t.oOptions,"hiddenElementsPosition","left");a.css({position:"absolute",top:-1e3}),a.css(o,-1e3),t.oJua.addFile(i,s),t.generateNewInput(e)}}),y(t.oOptions,"multipleSizeLimit",d),t.oJua.getEvent("onLimitReached"))})))},I.prototype.cancel=function(e){this.oUids[e]=!1,this.oForms[e]&&(this.oForms[e].remove(),this.oForms[e]=!1)},w.prototype.bEnableDnD=!0,w.prototype.iDocTimer=0,w.prototype.oOptions={},w.prototype.oEvents={},w.prototype.oQueue=null,w.prototype.oDriver=null,w.prototype.on=function(e,t){return this.oEvents[e]=t,this},w.prototype.runEvent=function(e,t){this.oEvents[e]&&this.oEvents[e].apply(null,t||[])},w.prototype.getEvent=function(e){return this.oEvents[e]||null},w.prototype.cancel=function(e){this.oDriver.cancel(e)},w.prototype.isAjaxUploaderSupported=function(){return(e=document.createElement("input")).type="file",!!("XMLHttpRequest"in window&&"multiple"in e&&"FormData"in window&&(new XMLHttpRequest).upload);var e},w.prototype.setDragAndDropEnabledStatus=function(e){this.bEnableDnD=!!e},w.prototype.isDragAndDropSupported=function(){return this.oDriver.isDragAndDropSupported()},w.prototype.addNewFile=function(e){this.addFile(E(),e)},w.prototype.addFile=function(e,t){var i=this.getEvent("onSelect"),r=null,a=y(this.oOptions,"hidden",{}),l=this.getEvent("onComplete"),c=o.bind((function(e,t){var i,s,o=y(this.oOptions,"hidden",{}),n=JSON.parse(L(o.Parameters,[t]));this.oDriver.regTaskUid(e),this.oQueue.defer((i=this.oDriver.uploadTask,s=this.oDriver,function(){return i.apply(m(s)?null:s,Array.prototype.slice.call(arguments))}),e,t,n)}),this),u=this.getEvent("onCancel");if(!t||i&&!1===i(e,t))this.oDriver.cancel(e);else{r=o.bind((function(e,t,i,o,n,a){var c;c=function(t,o){var n=null;try{n=s.parseJSON(t)}catch(e){}n&&n.Result&&!n.Result.Error&&!n.ErrorCode?i(e,r):n&&n.Result&&n.Result.Error?(h.broadcastEvent("Jua::FileUploadingError"),l(o,!1,{ErrorCode:n.Result.Error})):n&&n.ErrorCode?(h.broadcastEvent("Jua::FileUploadingError"),l(o,!1,{ErrorCode:n.ErrorCode})):(h.broadcastEvent("Jua::FileUploadingError"),l(o,!1))};var u=y(this.oOptions,"hidden",{}),p=JSON.parse(L(u.Parameters,[t]));this.oDriver.regTaskUid(e),this.oDriver.uploadTask(e,t,p,c,o<n,!0,a)}),this);var p=n.observable(!0),d=JSON.parse(L(a.Parameters,[t]));h.broadcastEvent("Jua::FileUpload::isUploadAvailable",{isUploadAvailable:p,sModuleName:a.Module,sUid:e,oFileInfo:t}),p()?!1===h.broadcastEvent("Jua::FileUpload::before",{sUid:e,oFileInfo:t,fOnChunkReadyCallback:r,sModuleName:a.Module,fRegularUploadFileCallback:c,fCancelFunction:u,sStorageType:d.Type})&&c(e,t):o.isFunction(u)&&u(e)}},w.prototype.setOption=function(e,t){this.oOptions[e]=t},e.exports=w},oDKb:function(e,t,i){const s=i("AFLV"),o={updateExtendedProps:function(e={}){this.oExtendedProps||(this.oExtendedProps={});for(const t in e)this.oExtendedProps[t]=e[t];this.parseExtendedProps()},parseExtendedProps:function(){const e=this.oExtendedProps.SharedWithMeAccess,t=s.pArray(this.oExtendedProps.Shares);this.sharedWithMeAccessReshare(e===Enums.SharedFileAccess.Reshare),this.sharedWithMeAccessWrite(this.sharedWithMeAccessReshare()||e===Enums.SharedFileAccess.Write),this.sharedWithMe(this.sharedWithMeAccessWrite()||e===Enums.SharedFileAccess.Read),this.sharedWithOthers(t.length>0)}};e.exports=o},p2SF:function(e,t,i){"use strict";var s=i("xG9w"),o=i("AFLV"),n=i("Jq2H"),r={};function a(e){return"p."===e.substr(0,"p.".length)}r.getFiles=function(e,t,i){var s=[n.HashModuleName];return e&&""!==e&&s.push(e),t&&""!==t&&s.push("p."+t),i&&""!==i&&s.push("s."+i),s},r.parseFiles=function(e){var t=0,i="personal",s="",n="";return o.isNonEmptyArray(e)&&(e.length>t&&!a(e[t])&&(i=o.pString(e[t]),t++),e.length>t&&a(e[t])&&(s=o.pString(e[t].substr("p.".length)),t++),e.length>t&&"s."===e[t].substr(0,"s.".length)&&(n=o.pString(e[t].substr("s.".length)))),r.getParsedParams(i,s,n)},r.getParsedParams=function(e,t,i){var n=[],r="";return o.isNonEmptyString(t)?r=(n=s.without(t.split(/(?:\/|\$ZIP\:)/g),""))[n.length-1]:t="",{Storage:e,Path:t,PathParts:n,Name:r,Search:i}},e.exports=r},qsz4:function(e,t,i){"use strict";var s=i("xG9w"),o=i("EVdn"),n=i("0h2I"),r=i("czxF");function a(){r.call(this),this.fCallback=null,this.name=n.observable(""),this.focused=n.observable(!1),this.error=n.observable(""),this.name.subscribe((function(){this.error("")}),this)}s.extendOwn(a.prototype,r.prototype),a.prototype.PopupTemplate="FilesWebclient_RenamePopup",a.prototype.onOpen=function(e,t){this.fCallback=t,this.name(e),this.focused(!0),this.error("")},a.prototype.onOKClick=function(){if(this.error(""),o.isFunction(this.fCallback)){var e=this.fCallback(this.name());e?this.error(e):setTimeout(function(){this.closePopup()}.bind(this))}else setTimeout(function(){this.closePopup()}.bind(this))},e.exports=new a},"w+bY":function(e,t,i){var s;!function(){function o(e){function t(){for(;a=c<h.length&&e>u;){var t=c++,s=h[t],o=r.call(s,1);o.push(i(t)),++u,s[0].apply(null,o)}}function i(e){return function(i,o){--u,null==d&&(null!=i?(d=i,c=p=NaN,s()):(h[e]=o,--p?a||t():s()))}}function s(){null!=d?m(d):l?m(d,h):m.apply(null,[d].concat(h))}var o,a,l,h=[],c=0,u=0,p=0,d=null,m=n;return e||(e=1/0),o={defer:function(){return d||(h.push(arguments),++p,t()),o},await:function(e){return m=e,l=!1,p||s(),o},awaitAll:function(e){return m=e,l=!0,p||s(),o}}}function n(){}var r=[].slice;o.version="1.0.7",void 0===(s=function(){return o}.call(t,i,t,e))||(e.exports=s)}()},zu1B:function(e,t,i){"use strict";(function(t){const s=i("xG9w"),o=i("0h2I"),n=i("RN+F"),r=i("Yjhd"),a=i("o0Bx"),l=i("JFZZ"),h=i("IAk5"),c=i("czxF"),u=i("mjrp"),p=i("OgeD"),d=i("76Kh"),m=i("SQrT"),f=i("hPb3"),b=i("dtb0"),y=p.run("CoreParanoidEncryptionWebclientPlugin","isEnabled");function g(){c.call(this),this.filesView=new b(!0,!1),this.filesView.onSelectClickPopupBound=()=>{},this.filesView.onCreateFolderResponse=function(e,t){if(e.Result){const e=`${t.Parameters.Path}/${t.Parameters.FolderName}`,i=t.Parameters.Type;this.routeFiles(i,e,"",!0)}else l.showErrorByCode(e),this.routeFiles(this.storageType(),this.currentPath(),this.searchPattern(),!0)}.bind(this.filesView),this.isSaving=o.observable(!1),this.isSaving.subscribe((function(){this.filesView.disableRoute=this.isSaving()}),this),this.allowCreateFolder=o.computed((function(){return!this.isSaving()}),this),this.createFolderCommand=r.createCommand(this,this.createFolder,this.allowCreateFolder),this.allowSelectFolder=o.computed((function(){return!this.isSaving()&&("shared"!==this.filesView.storageType()||""!==this.filesView.currentPath())}),this),this.selectFolderCommand=r.createCommand(this,this.selectFolder,this.allowSelectFolder)}s.extendOwn(g.prototype,c.prototype),g.prototype.PopupTemplate="MailSaveAttachmentsToFilesPlugin_SelectFilesPopup",g.prototype.onOpen=function(e,t){this.initUploader(),this.attachmentsData=e.map(e=>({attach:e,FileName:e.fileName(),Size:e.size(),Hash:e.hash(),Type:e.mimeType()})),this.accountId=t,this.filesView.onShow(),this.filesView.routeFiles("personal","")},g.prototype.onBind=function(){this.filesView.onBind(this.$popupDom)},g.prototype.hideLoading=function(){this.isSaving(!1),m.hideLoading()},g.prototype.onClose=function(){this.hideLoading()},g.prototype.selectFolder=function(){const e=this.attachmentsData.filter(e=>this.filesView.isFileCanBeUploaded(e));if(e.length>0){const t=[this.filesView.storageType(),this.filesView.currentPath(),this.accountId,e],i=()=>{this.encryptAndSaveToFolder(e)},s=()=>{this.saveToFolder(...t)},o=()=>{this.closePopup()};if(y){const t=p.run("CoreParanoidEncryptionWebclientPlugin","getConfirmEncryptionPopup");"encrypted"===this.filesView.storageType()?i():"personal"===this.filesView.storageType()&&t?d.showPopup(t,[i,s,o,e.length,e.map(e=>e.FileName)]):s()}else s()}},g.prototype.saveToFolder=function(e,t,i,s){s.forEach(e=>{this.filesView.onFileUploadSelect(e.Hash,e),this.filesView.onFileUploadStart(e.Hash),this.filesView.onFileUploadProgress(e.Hash,.2*e.Size,e.Size)});const o={AccountID:i,Attachments:s.map(e=>e.Hash),Storage:e,Path:t};m.showLoading(n.i18n("COREWEBCLIENT/INFO_LOADING")),this.isSaving(!0),a.send("MailSaveAttachmentsToFilesPlugin","Save",o,e=>{this.hideLoading(),e.Result?(this.attachmentsData.forEach(e=>{this.filesView.onFileUploadComplete(e.Hash,!0,{Result:!0})}),this.onFileUploadComplete()):l.showErrorByCode(e)})},g.prototype.onFileUploadComplete=function(){if(this.filesView.uploadingFiles().length>0)return;const e=p.run("FilesWebclient","getHeaderItem");e&&e.item&&e.item.recivedAnim(!0);const t=this.attachmentsData.length,i=n.i18n("MAILSAVEATTACHMENTSTOFILESPLUGIN/REPORT_FILES_SAVED_SUCCESSFULLY_PLURAL",null,null,t);m.showReport(i),setTimeout(()=>{this.closePopup()},1e3),this.hideLoading()},g.prototype.encryptAndSaveToFolder=function(e){e.forEach(e=>{this.filesView.onFileUploadSelect(e.Hash,e),this.filesView.onFileUploadStart(e.Hash),this.filesView.onFileUploadProgress(e.Hash,.1*e.Size,e.Size)}),m.showLoading(n.i18n("COREWEBCLIENT/INFO_LOADING")),this.isSaving(!0);e.map(e=>e.attach).forEach(e=>{const i=e.getActionUrl("download");t.ajax({url:i,cache:!1,xhrFields:{responseType:"blob"},success:t=>{this.encryptBlob(e,t)},error:function(t){this.hideLoading(),this.filesView.onFileUploadComplete(e.hash(),!1,{Result:!1})}})})},g.prototype.encryptBlob=function(e,t){this.oJua.addFile(e.hash(),{File:t,FileName:e.fileName(),Folder:"",Size:t.size,Type:t.type,EncryptWithoutConfirm:!0});const i=this.filesView.getUploadFileByUid(e.hash());i&&this.filesView.onFileUploadProgress(e.hash(),.2*i.size(),i.size())},g.prototype.initUploader=function(){this.oJua||(this.oJua=new u({action:"?/Api/",name:"jua-uploader",queueSize:2,clickElement:null,hiddenElementsPosition:f.IsRTL?"right":"left",dragAndDropElement:null,disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!0,hidden:s.extendOwn({Module:"Files",Method:"UploadFile",Parameters:e=>JSON.stringify({Type:this.filesView.storageType(),SubPath:"",Path:this.filesView.currentPath(),Overwrite:!1})},h.getCommonRequestParameters())}),this.oJua.on("onProgress",(e,t,i)=>{let s=t/i;s<.2&&(s=.2),this.filesView.onFileUploadProgress(e,i*s,i)}).on("onSelect",this.filesView.onFileUploadSelect.bind(this.filesView)).on("onStart",e=>{this.filesView.onFileUploadStart(e);const t=this.filesView.getUploadFileByUid(e);t&&this.filesView.onFileUploadProgress(e,.2*t.size(),t.size())}).on("onComplete",(e,t,i)=>{this.filesView.onFileUploadComplete(e,t,i),this.onFileUploadComplete()}).on("onCancel",e=>{this.filesView.onCancelUpload(e),0===this.filesView.uploadingFiles().length&&this.hideLoading()}))},g.prototype.createFolder=function(){this.filesView.executeCreateFolder()},e.exports=new g}).call(this,i("EVdn"))}}]);