(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"2d9n":function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("RN+F"),a=n("czxF");function s(){a.call(this),this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable(""),this.sErrorText=o.observable("")}r.extendOwn(s.prototype,a.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmUploadPopup",s.prototype.onOpen=function(t,e,n,o,a){var s=r.map(o,(function(t){return i.encodeHtml(t)}));this.filesConfirmText(""),this.fUpload=t,this.fCancel=e,this.message(i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_UPLOAD_PLURAL",{VALUE:n>1?n:'"'+o[0]+'"'},null,n)),n>1&&this.filesConfirmText(s.join("<br />")),this.sErrorText(a)},s.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},s.prototype.upload=function(){this.fUpload(),this.closePopup()},t.exports=new s},"2kfa":function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("IAk5"),a=n("czxF"),s=n("zDR0");function c(){a.call(this),this.keyName=o.observable(i.getUserPublicId()),this.fOnGenerateCallback=null}r.extendOwn(c.prototype,a.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_GenerateKeyPopup",c.prototype.onOpen=function(t){this.fOnGenerateCallback=t},c.prototype.generateKey=function(){s.generateAndExportKey(r.bind((function(){this.fOnGenerateCallback()}),this),this.keyName()),this.closePopup()},t.exports=new c},B9Yq:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},I5pT:function(t,e,n){"use strict";var r=n("0h2I"),o=n("xG9w"),i=n("AFLV");t.exports={ServerModuleName:"CoreParanoidEncryptionWebclientPlugin",HashModuleName:"paranoid-encryption",EncryptionAllowedModules:["Files"],EncryptionAllowedStorages:["personal"],enableJscrypto:r.observable(!0),EnableInPersonalStorage:!1,ChunkSizeMb:5,AllowMultiChunkUpload:!0,AllowChangeSettings:!1,DontRemindMe:r.observable(!1),init:function(t){var e=o.extend({},t[this.ServerModuleName]||{},t.CoreParanoidEncryptionWebclientPlugin||{});o.isEmpty(e)||(this.enableJscrypto(i.pBool(e.EnableModule,this.enableJscrypto())),this.DontRemindMe(i.pBool(e.DontRemindMe,this.DontRemindMe())),this.EnableInPersonalStorage=i.pBool(e.EnableInPersonalStorage,this.EnableInPersonalStorage),this.ChunkSizeMb=i.pInt(e.ChunkSizeMb,this.ChunkSizeMb),this.AllowMultiChunkUpload=i.pBool(e.AllowMultiChunkUpload,this.AllowMultiChunkUpload),this.AllowChangeSettings=i.pBool(e.AllowChangeSettings,this.AllowChangeSettings))},update:function(t,e){this.enableJscrypto(t),this.EnableInPersonalStorage=e}}},LU2F:function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("czxF");function a(){i.call(this),this.keyPassword=o.observable(""),this.fOnPasswordEnterCallback=null,this.fOnCancellCallback=null}r.extendOwn(a.prototype,i.prototype),a.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_DecryptKeyPasswordPopup",a.prototype.onOpen=function(t,e){this.fOnPasswordEnterCallback=t,this.fOnCancellCallback=e},a.prototype.decryptKey=function(){r.isFunction(this.fOnPasswordEnterCallback)&&this.fOnPasswordEnterCallback(this.keyPassword()),this.closePopup()},a.prototype.cancelPopup=function(){r.isFunction(this.fOnCancellCallback)&&this.fOnCancellCallback(),this.closePopup()},a.prototype.onShow=function(){this.keyPassword("")},t.exports=new a},MYcH:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,a=t},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw a}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var i=e&&e.prototype instanceof y?e:y,a=Object.create(i.prototype),s=new x(r||[]);return o(a,"_invoke",{value:P(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var f={};function y(){}function d(){}function v(){}var E={};l(E,s,(function(){return this}));var w=Object.getPrototypeOf,m=w&&w(w(I([])));m&&m!==e&&n.call(m,s)&&(E=m);var b=v.prototype=y.prototype=Object.create(E);function g(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){var i;o(this,"_invoke",{value:function(o,a){function s(){return new e((function(i,s){!function o(i,a,s,c){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){o("next",t,s,c)}),(function(t){o("throw",t,s,c)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return o("throw",t,s,c)}))}c(u.arg)}(o,a,i,s)}))}return i=i?i.then(s,s):s()}})}function P(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return R()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=N(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function N(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,N(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=p(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function I(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return d.prototype=v,o(b,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:d,configurable:!0}),d.displayName=l(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(C.prototype),l(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new C(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),l(b,u,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=I,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function s(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){s(i,r,o,a,c,"next",t)}function c(t){s(i,r,o,a,c,"throw",t)}a(void 0)}))}}var u=n("xG9w"),l=n("RN+F"),h=(n("AFLV"),n("o0Bx"),n("OgeD")),p=n("SQrT"),f=h.run("OpenPgpWebclient","getOpenPgpEncryptor"),y=n("QJDP");function d(t){return v.apply(this,arguments)}function v(){return(v=c(a().mark((function t(e){var n,r,o,i,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.map((function(t){return t.ContactUUID})).filter((function(t){return t})),r=e.map((function(t){return t.PublicId})),t.next=3,f.getPublicKeysByContactsAndEmails(n,r);case 3:return(o=t.sent).length<r.length&&(i=o.map((function(t){return t.getEmail()})),s=r.filter((function(t){return!i.includes(t)})),c=l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_NO_PUBLIC_KEYS_FOR_USERS_PLURAL",{USERS:s.join(", ")},null,s.length),p.showError(c),o=!1),t.abrupt("return",o);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(t){return w.apply(this,arguments)}function w(){return(w=c(a().mark((function t(e){var n,r,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.getCurrentUserPrivateKey();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=7,f.askForKeyPassword(n.getUser());case 7:if(r=t.sent){t.next=10;break}return t.abrupt("return",!1);case 10:return t.next=12,y.decryptParanoidKey(e,r);case 12:return o=t.sent,t.abrupt("return",{decryptedParanoidKey:o,password:r});case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function m(){return(m=c(a().mark((function t(e){var n,r,i,s,c,l,h,p,f,v,w;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(u.isFunction(e.OnSuccessCallback)&&u.isFunction(e.OnErrorCallback)){t.next=2;break}return t.abrupt("return");case 2:if(n=e.FileItem,r=n&&n.oExtendedProps,i=r&&(n.sharedWithMe()?r.ParanoidKeyShared:r.ParanoidKey),n&&n.IS_FILE&&i&&u.isArray(e.Shares)){t.next=6;break}return e.OnSuccessCallback(),t.abrupt("return");case 6:if(0!==(s=e.Shares.filter((function(t){return t.New}))).length){t.next=10;break}return e.OnSuccessCallback(),t.abrupt("return");case 10:return t.next=12,d(s);case 12:if(c=t.sent){t.next=16;break}return e.OnErrorCallback(),t.abrupt("return");case 16:return t.next=18,E(i);case 18:if(l=t.sent,h=l.decryptedParanoidKey,p=l.password,h){t.next=24;break}return e.OnErrorCallback(),t.abrupt("return");case 24:f=o(e.Shares),t.prev=25,w=a().mark((function t(){var e,n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=v.value,!(n=c.find((function(t){return t.emailParts.email===e.PublicId})))){t.next=8;break}return t.next=5,y.encryptParanoidKey(h,[n],p);case 5:(r=t.sent)&&(e.ParanoidKeyShared=r),delete e.New;case 8:case"end":return t.stop()}}),t)})),f.s();case 28:if((v=f.n()).done){t.next=32;break}return t.delegateYield(w(),"t0",30);case 30:t.next=28;break;case 32:t.next=37;break;case 34:t.prev=34,t.t1=t.catch(25),f.e(t.t1);case 37:return t.prev=37,f.f(),t.finish(37);case 40:e.OnSuccessCallback();case 41:case"end":return t.stop()}}),t,null,[[25,34,37,40]])})))).apply(this,arguments)}t.exports={onBeforeUpdateShare:function(t){return m.apply(this,arguments)}}},Npm9:function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("IAk5"),a=n("czxF"),s=n("zDR0");function c(){a.call(this),this.keyName=o.observable(i.getUserPublicId()),this.newKey=o.observable("")}r.extendOwn(c.prototype,a.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ImportKeyStringPopup",c.prototype.onOpen=function(){this.newKey("")},c.prototype.importKey=function(){s.importKeyFromString(this.keyName(),this.newKey()),this.closePopup()},t.exports=new c},PDX0:function(t,e){(function(e){t.exports=e}).call(this,{})},QJDP:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var i=e&&e.prototype instanceof y?e:y,a=Object.create(i.prototype),s=new x(r||[]);return o(a,"_invoke",{value:P(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var f={};function y(){}function d(){}function v(){}var E={};l(E,s,(function(){return this}));var w=Object.getPrototypeOf,m=w&&w(w(I([])));m&&m!==e&&n.call(m,s)&&(E=m);var b=v.prototype=y.prototype=Object.create(E);function g(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){var i;o(this,"_invoke",{value:function(o,a){function s(){return new e((function(i,s){!function o(i,a,s,c){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){o("next",t,s,c)}),(function(t){o("throw",t,s,c)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return o("throw",t,s,c)}))}c(u.arg)}(o,a,i,s)}))}return i=i?i.then(s,s):s()}})}function P(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return R()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=N(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function N(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,N(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=p(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function I(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return d.prototype=v,o(b,"constructor",{value:v,configurable:!0}),o(v,"constructor",{value:d,configurable:!0}),d.displayName=l(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(C.prototype),l(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new C(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),l(b,u,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=I,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function s(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var i=t.apply(e,n);function a(t){s(i,r,o,a,c,"next",t)}function c(t){s(i,r,o,a,c,"throw",t)}a(void 0)}))}}var u=n("EVdn"),l=n("xG9w"),h=n("OgeD"),p=n("SQrT"),f=n("RN+F"),y=n("uN/E"),d=n("zDR0"),v=n("Yjhd"),E=n("wjWM"),w=n("76Kh"),m=n("hJUJ"),b=n("TrqT"),g=n("I5pT"),C=h.run("OpenPgpWebclient","getOpenPgpEncryptor");function P(){this.iChunkNumber=0,this.iChunkSize=1024*g.ChunkSizeMb*1024,this.iCurrChunk=0,this.oChunk=null,this.iv=null,this.oChunkQueue={isProcessed:!1,privateKeyPassword:"",aFiles:[]},this.aStopList=[],this.fOnUploadCancelCallback=null,this.oKey=null}function N(t,e,n,r,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this.oWriter=new k(t.fileName(),r),this.init(t,e,n,o,i)}function O(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.oWriter=null,this.init(t,e,n,null,r)}function k(t,e){this.sName=t,this.aBuffer=[],l.isFunction(e)&&(this.fProcessBlobCallback=e)}function x(t){this.sName=t,this.aBuffer=[],this.imgWindow=window.open("","_blank","height=auto, width=auto,toolbar=no,scrollbars=no,resizable=yes")}P.prototype.start=function(){var t=c(a().mark((function t(e){var n,r=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=r.length>1&&void 0!==r[1]?r[1]:"",this.oFileInfo=e,this.oFile=e.File,this.iChunkNumber=Math.ceil(e.File.size/this.iChunkSize),this.iCurrChunk=0,this.oChunk=null,this.iv=window.crypto.getRandomValues(new Uint8Array(16)),this.oFileInfo.Hidden={RangeType:1,Overwrite:!0},this.oFileInfo.Hidden.ExtendedProps={InitializationVector:E.Array2HexString(new Uint8Array(this.iv))},n&&(this.oFileInfo.Hidden.ExtendedProps.ParanoidKey=n);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.startUpload=function(){var t=c(a().mark((function t(e,n,r,o){var i,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.oChunkQueue.isProcessed=!0,t.next=3,d.generateKey();case 3:return this.oKey=t.sent,t.next=6,d.convertKeyToString(this.oKey);case 6:return i=t.sent,t.next=9,C.getCurrentUserPrivateKey();case 9:if(!t.sent||!i){t.next=30;break}return t.next=13,C.getCurrentUserPublicKey();case 13:if(!(s=t.sent)){t.next=27;break}return t.next=17,this.encryptParanoidKey(i,[s]);case 17:if(!(c=t.sent)){t.next=24;break}return t.next=21,this.start(e,c);case 21:this.readChunk(n,r),t.next=25;break;case 24:l.isFunction(o)&&o();case 25:t.next=28;break;case 27:l.isFunction(o)&&o();case 28:t.next=31;break;case 30:l.isFunction(o)&&o();case 31:case"end":return t.stop()}}),t,this)})));return function(e,n,r,o){return t.apply(this,arguments)}}(),P.prototype.readChunk=function(t,e){var n=this.iChunkSize*this.iCurrChunk,r=this.iCurrChunk<this.iChunkNumber-1?this.iChunkSize*(this.iCurrChunk+1):this.oFile.size,o=new FileReader,i=null;if(-1!==this.aStopList.indexOf(t))return this.aStopList.splice(this.aStopList.indexOf(t),1),void this.checkQueue();if(this.oFile.slice?i=this.oFile.slice(n,r):this.oFile.webkitSlice?i=this.oFile.webkitSlice(n,r):this.oFile.mozSlice&&(i=this.oFile.mozSlice(n,r)),i)try{o.onloadend=l.bind((function(n){n.target.readyState===FileReader.DONE&&(this.oChunk=n.target.result,this.iCurrChunk++,this.encryptChunk(t,e))}),this),o.readAsArrayBuffer(i)}catch(t){p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}},P.prototype.encryptChunk=function(t,e){crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},this.oKey,this.oChunk).then(l.bind((function(n){n=this.iChunkNumber>1&&this.iCurrChunk!==this.iChunkNumber?n.slice(0,n.byteLength-16):n;var r=new Blob([n],{type:"text/plain",lastModified:new Date}),o=l.bind((function(t,e){this.iCurrChunk<this.iChunkNumber?this.readChunk(t,e):(this.oChunkQueue.isProcessed=!1,this.checkQueue())}),this);this.oFileInfo.File=r,this.iv=new Uint8Array(n.slice(n.byteLength-16)),1===this.iCurrChunk?this.oFileInfo.Hidden.ExtendedProps.FirstChunk=!0:this.oFileInfo.Hidden.ExtendedProps.FirstChunk=null,this.iCurrChunk==this.iChunkNumber?this.oFileInfo.Hidden.ExtendedProps.Loading=null:this.oFileInfo.Hidden.ExtendedProps.Loading=!0,e(t,this.oFileInfo,o,this.iCurrChunk,this.iChunkNumber,(this.iCurrChunk-1)*this.iChunkSize)}),this)).catch((function(t){p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}))},P.prototype.downloadDividedFile=function(){var t=c(a().mark((function t(e,n,r,o){var i,s,c=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=c.length>4&&void 0!==c[4]?c[4]:"",e.startDownloading(),t.next=4,this.prepareKey(e,i);case 4:!1!==(s=t.sent)?new N(e,n,this.iChunkSize,r,o,s):e.stopDownloading();case 6:case"end":return t.stop()}}),t,this)})));return function(e,n,r,o){return t.apply(this,arguments)}}(),P.prototype.prepareKey=function(){var t=c(a().mark((function t(e){var n,r,o=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:"",r="",!n){t.next=10;break}return t.next=5,this.decryptParanoidKey(n);case 5:if(r=t.sent){t.next=8;break}return t.abrupt("return",!1);case 8:t.next=22;break;case 10:if(g.DontRemindMe()){t.next=16;break}return t.next=13,this.showOutdatedEncryptionMethodPopup(e.fileName());case 13:if(t.sent){t.next=16;break}return t.abrupt("return",!1);case 16:if(this.isKeyInStorage()){t.next=22;break}return t.next=19,this.getTemporaryKeyAsString();case 19:if(r=t.sent){t.next=22;break}return t.abrupt("return",!1);case 22:return t.abrupt("return",r);case 23:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.getTemporaryKeyAsString=c(a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=new Promise((function(t,e){w.showPopup(b,[function(e){t(e)},function(){t(!1)}])})),t.next=3,e;case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)}))),P.prototype.showOutdatedEncryptionMethodPopup=function(){var t=c(a().mark((function t(e){var n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Promise((function(t,n){w.showPopup(m,[e,function(){t(!0)},function(){t(!1)}])})),t.next=3,n;case 3:return r=t.sent,t.abrupt("return",r);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.encryptParanoidKey=function(){var t=c(a().mark((function t(e,n){var r,o,i,s,c,u,l,h=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return""===(r=h.length>2&&void 0!==h[2]?h[2]:"")&&(r=this.oChunkQueue.privateKeyPassword),o="",t.next=5,C.getCurrentUserPrivateKey();case 5:if(!(i=t.sent)){t.next=11;break}return t.next=9,C.encryptData(e,n,[i],!1,!0,r);case 9:(s=t.sent).result?(c=s.result,u=c.data,l=c.passphrase,this.oChunkQueue.privateKeyPassword=l,o=u):(s.hasErrors()||s.hasNotices())&&C.showPgpErrorByCode(s,"",f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"));case 11:return t.abrupt("return",o);case 12:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),P.prototype.decryptParanoidKey=function(){var t=c(a().mark((function t(e){var n,r,i,s,c,u,h,y=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=y.length>1&&void 0!==y[1]?y[1]:"",r="",t.next=4,C.decryptData(e,n);case 4:if(!(i=t.sent).result){t.next=17;break}if(r=i.result,!i.validKeyNames||!i.validKeyNames.length){t.next=14;break}return t.next=10,C.getCurrentUserPrivateKey();case 10:(s=t.sent)&&i.validKeyNames.includes(s.getUser())||(c=f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/REPORT_SUCCESSFULL_SIGNATURE_VERIFICATION")+i.validKeyNames.join(", ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),p.showReport(c)),t.next=15;break;case 14:i.notices&&-1!==l.indexOf(i.notices,Enums.OpenPgpErrors.VerifyErrorNotice)&&p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_SIGNATURE_NOT_VERIFIED"));case 15:t.next=18;break;case 17:(i.hasErrors()||i.hasNotices())&&(u=i.errors?i.errors:[],h=i.notices?i.notices:[],[].concat(o(u),o(h)).some((function(t){return t.length&&t[0]===Enums.OpenPgpErrors.PrivateKeyNotFoundError}))?p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_NO_PRIVATE_KEY_FOUND_FOR_DECRYPT")):C.showPgpErrorByCode(i,"",f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")));case 18:return t.abrupt("return",r);case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),P.prototype.checkQueue=function(){var t=null;this.oChunkQueue.aFiles.length>0?(t=this.oChunkQueue.aFiles.shift()).fStartUploadCallback.apply(t.fStartUploadCallback,[t.oFileInfo,t.sUid,t.fOnChunkEncryptCallback]):this.oChunkQueue.privateKeyPassword=""},P.prototype.stopUploading=function(t,e,n){var r=!1;this.oChunkQueue.aFiles.forEach((function(n,o,i){n.sUid===t&&(e(t,n.oFileInfo.FileName),i.splice(o,1),r=!0)})),r||(this.aStopList.push(t),this.oChunkQueue.isProcessed=!1,e(t,n),this.oKey=null)},P.prototype.viewEncryptedImage=function(){var t=c(a().mark((function t(e,n){var r,o,i=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:"",e.startDownloading(),t.next=4,this.prepareKey(e,r);case 4:!1!==(o=t.sent)?new O(e,n,this.iChunkSize,o):e.stopDownloading();case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),P.prototype.isKeyInStorage=function(){return!!d.loadKeyFromStorage()},N.prototype.init=function(){var t=c(a().mark((function t(e,n,r,o,i){var s,c,u=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.sHash=v.getRandomHash(),this.oFile=e,this.sFileName=e.fileName(),this.iFileSize=e.size(),this.sDownloadLink=e.getActionUrl("download"),this.iCurrChunk=0,this.iv=new Uint8Array(E.HexString2Array(n)),this.key=null,this.iChunkNumber=Math.ceil(this.iFileSize/r),this.iChunkSize=r,this.fProcessBlobErrorCallback=o,this.sDownloadLink.indexOf("&")>0&&(this.sDownloadLink=this.sDownloadLink.substring(0,this.sDownloadLink.indexOf("&"))),s=function(){l.isFunction(u.fProcessBlobErrorCallback)&&u.fProcessBlobErrorCallback(),u.stopDownloading()},!i){t.next=20;break}return t.next=16,d.getKeyFromString(i);case 16:(c=t.sent)?(this.key=c,this.decryptChunk()):s(),t.next=21;break;case 20:d.getKey((function(t){u.key=t,u.decryptChunk()}),s);case 21:case"end":return t.stop()}}),t,this)})));return function(e,n,r,o,i){return t.apply(this,arguments)}}(),N.prototype.writeChunk=function(t){!0===this.oFile.downloading()&&(this.oWriter.write(t),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close()))},N.prototype.decryptChunk=function(){var t=new XMLHttpRequest;t.open("GET",this.getChunkLink(),!0),t.responseType="arraybuffer",t.onprogress=l.bind((function(e){this.isDownloading()?this.oFile.onDownloadProgress(e.loaded+(this.iCurrChunk-1)*this.iChunkSize,this.iFileSize):t.abort()}),this),t.onload=l.bind((function(e){var n=t.response,r={};200===t.status&&n&&((r=new Uint8Array(n.byteLength+16)).set(new Uint8Array(n),0),this.iCurrChunk!==this.iChunkNumber?crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(n.slice(n.byteLength-16))},this.key,new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]).buffer).then(l.bind((function(t){r.set(new Uint8Array(new Uint8Array(t.slice(0,16))),n.byteLength),crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,r.buffer).then(l.bind((function(t){var e=new Uint8Array(t);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(e)}),this)).catch(l.bind((function(t){this.stopDownloading(),l.isFunction(this.fProcessBlobErrorCallback)&&this.fProcessBlobErrorCallback(),p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this))}),this)):crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,n).then(l.bind((function(t){var e=new Uint8Array(t);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(e)}),this)).catch(l.bind((function(t){this.stopDownloading(),l.isFunction(this.fProcessBlobErrorCallback)&&this.fProcessBlobErrorCallback(),p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this)))}),this),t.send(null)},N.prototype.stopDownloading=function(){this.oFile.stopDownloading()},N.prototype.getChunkLink=function(){return this.sDownloadLink+"/download/"+this.iCurrChunk+++"/"+this.iChunkSize+"&"+this.sHash},N.prototype.isDownloading=function(){return this.oFile.downloading()},O.prototype=Object.create(N.prototype),O.prototype.constructor=O,O.prototype.writeChunk=function(t){this.oWriter=null===this.oWriter?new x(this.sFileName):this.oWriter,this.oWriter.write(t),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close())},k.prototype.write=function(t){this.aBuffer.push(t)},k.prototype.close=function(){var t=new Blob(this.aBuffer);void 0!==this.fProcessBlobCallback?this.fProcessBlobCallback(t):y.saveAs(t,this.sName),t=null},x.prototype=Object.create(k.prototype),x.prototype.constructor=x,x.prototype.close=function(){try{var t=new Blob(this.aBuffer),e=window.URL.createObjectURL(t);this.imgWindow.document.write("<head><title>"+this.sName+'</title></head><body><img src="'+e+'" /></body>'),u(this.imgWindow.document.body).find("img").on("load",(function(){window.URL.revokeObjectURL(e)}))}catch(t){p.showError(f.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_POPUP_WINDOWS"))}},t.exports=new P},TrqT:function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("czxF"),a=n("RN+F"),s=n("SQrT");function c(){i.call(this),this.key=o.observable(""),this.fOnKeyEnterCallback=null,this.fOnCancellCallback=null}r.extendOwn(c.prototype,i.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_GetTemporaryKeyPopup",c.prototype.onOpen=function(t,e){this.key(""),this.fOnKeyEnterCallback=t,this.fOnCancellCallback=e},c.prototype.cancel=function(){this.fOnCancellCallback(),this.closePopup()},c.prototype.enterKey=function(){""===this.key()?s.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_KEY_CANT_BE_BLANK")):(this.fOnKeyEnterCallback(this.key()),this.closePopup())},t.exports=new c},Z2LC:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof y?e:y,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:P(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var f={};function y(){}function d(){}function v(){}var E={};l(E,s,(function(){return this}));var w=Object.getPrototypeOf,m=w&&w(w(I([])));m&&m!==e&&n.call(m,s)&&(E=m);var b=v.prototype=y.prototype=Object.create(E);function g(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){var o;i(this,"_invoke",{value:function(i,a){function s(){return new e((function(o,s){!function o(i,a,s,c){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){o("next",t,s,c)}),(function(t){o("throw",t,s,c)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return o("throw",t,s,c)}))}c(u.arg)}(i,a,o,s)}))}return o=o?o.then(s,s):s()}})}function P(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return R()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=N(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function N(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,N(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=p(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function I(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return d.prototype=v,i(b,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:d,configurable:!0}),d.displayName=l(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(C.prototype),l(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new C(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),l(b,u,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=I,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function i(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function s(t){i(a,r,o,s,c,"next",t)}function c(t){i(a,r,o,s,c,"throw",t)}s(void 0)}))}}var s=n("xG9w"),c=n("0h2I"),u=n("RN+F"),l=n("AFLV"),h=n("czxF"),p=n("76Kh"),f=n("1grR");function y(){h.call(this),this.fileName=c.observable(""),this.iv=c.observable(""),this.oldEncryptionMode=c.observable(!1),this.encryptedParanoidKey=""}s.extendOwn(y.prototype,h.prototype),y.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_InitializationVectorPopup",y.prototype.onOpen=function(t,e){this.oFile=t,this.fileName(t.fileName()),this.iv(e);var n=t&&t.oExtendedProps,r=n&&(t.sharedWithMe()?n.ParanoidKeyShared:n.ParanoidKey);this.encryptedParanoidKey=r,this.oldEncryptionMode(!r)},y.prototype.downloadEncrypted=function(){var t;s.isFunction(null===(t=this.oFile)||void 0===t?void 0:t.downloadFile)&&this.oFile.downloadFile(!0)},y.prototype.getAesKey=a(o().mark((function t(){var e,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=n("QJDP"),t.next=3,e.decryptParanoidKey(this.encryptedParanoidKey);case 3:r=t.sent,l.isNonEmptyString(r)&&p.showPopup(f,[r,null,u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/HEADING_IV_AES_KEY")]);case 5:case"end":return t.stop()}}),t,this)}))),t.exports=new y},c2EW:function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("RN+F"),a=n("czxF");function s(){a.call(this),this.fEncrypt=null,this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable("")}r.extendOwn(s.prototype,a.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmEncryptionPopup",s.prototype.onOpen=function(t,e,n,o,a){var s=r.map(a,(function(t){return i.encodeHtml(t)}));this.filesConfirmText(""),this.fEncrypt=t,this.fUpload=e,this.fCancel=n,this.message(i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_ENCRYPT_PLURAL",{VALUE:o>1?o:'"'+a[0]+'"'},null,o)),o>1&&this.filesConfirmText(s.join("<br />"))},s.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},s.prototype.encrypt=function(){this.fEncrypt(),this.closePopup()},s.prototype.upload=function(){this.fUpload(),this.closePopup()},t.exports=new s},hJUJ:function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("o0Bx"),a=n("I5pT"),s=n("RN+F"),c=n("czxF");function u(){c.call(this),this.message=o.observable(""),this.dontRemindMe=o.observable(!1),this.fContinueCallback=null,this.fCancelCallback=null}r.extendOwn(u.prototype,c.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_OutdatedEncryptionMethodPopup",u.prototype.onOpen=function(t,e,n){this.message(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/MESSAGE_OUTDATED_ENCRYPTION_METHOD",{FILENAME:t})),this.fContinueCallback=e,this.fCancelCallback=n},u.prototype.cancel=function(){this.fCancelCallback(),this.closePopup()},u.prototype.continueDownload=function(){this.dontRemindMe()&&i.send("CoreParanoidEncryptionWebclientPlugin","DontRemindMe",{},(function(t){!0===t.Result&&a.DontRemindMe(!0)}),this),this.fContinueCallback(),this.closePopup()},t.exports=new u},"mHl/":function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof y?e:y,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:P(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var f={};function y(){}function d(){}function v(){}var E={};l(E,s,(function(){return this}));var w=Object.getPrototypeOf,m=w&&w(w(I([])));m&&m!==e&&n.call(m,s)&&(E=m);var b=v.prototype=y.prototype=Object.create(E);function g(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){var o;i(this,"_invoke",{value:function(i,a){function s(){return new e((function(o,s){!function o(i,a,s,c){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){o("next",t,s,c)}),(function(t){o("throw",t,s,c)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return o("throw",t,s,c)}))}c(u.arg)}(i,a,o,s)}))}return o=o?o.then(s,s):s()}})}function P(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return R()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=N(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function N(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,N(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=p(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function I(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return d.prototype=v,i(b,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:d,configurable:!0}),d.displayName=l(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(C.prototype),l(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new C(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),l(b,u,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=I,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function i(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function s(t){i(a,r,o,s,c,"next",t)}function c(t){i(a,r,o,s,c,"throw",t)}s(void 0)}))}}var s=n("xG9w"),c=n("EVdn"),u=n("0h2I"),l=n("RN+F"),h=(n("AFLV"),n("OgeD")),p=n("SQrT"),f=h.run("SettingsWebclient","getAbstractSettingsFormViewClass"),y=n("76Kh"),d=n("zDR0"),v=n("I5pT"),E=n("Npm9"),w=n("2kfa"),m=n("t19A"),b=n("nTW+"),g=n("wjWM"),C=h.run("OpenPgpWebclient","getOpenPgpEncryptor");function P(){f.call(this,v.ServerModuleName),this.enableJscrypto=u.observable(v.enableJscrypto()),this.enableInPersonalStorage=u.observable(v.EnableInPersonalStorage),this.keyName=u.observable(""),this.bIsHttpsEnable="https:"===window.location.protocol,this.allowChangeSettings=u.observable(v.AllowChangeSettings),this.isImporting=u.observable(!1),this.exportKeyBound=s.bind(this.exportKey,this),this.isPGPKeysAvailable=u.observable(!0),u.isObservable(d.keyName)&&d.keyName.subscribe((function(){this.keyName(d.keyName())}),this),this.allowKeysManagement=u.observable(!!this.keyName()),this.keyName.subscribe((function(){this.keyName()&&this.allowKeysManagement(!0)}),this)}s.extendOwn(P.prototype,f.prototype),P.prototype.ViewTemplate="CoreParanoidEncryptionWebclientPlugin_ParanoidEncryptionSettingsFormView",P.prototype.enableBackwardCompatibility=function(){this.allowKeysManagement(!0)},P.prototype.importFileKey=function(){c("#import-key-file").click()},P.prototype.importStringKey=function(){y.showPopup(E)},P.prototype.readKeyFromFile=function(){var t,e=document.getElementById("import-key-file"),n=e.files[0],r=new FileReader,o="",i=e.files[0].name.split("."),a=s.bind((function(){this.isImporting(!1)}),this),c=s.bind((function(){this.isImporting(!1)}),this);if(i.splice(i.length-1,1),t=i.join(""),n){this.isImporting(!0),r.onload=function(e){o=e.target.result,d.importKeyFromString(t,o,a,c)};try{r.readAsText(n)}catch(t){p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))}}else p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))},P.prototype.generateNewKey=function(){y.showPopup(w,[s.bind((function(){y.showPopup(m,[this.exportKeyBound,this.keyName()])}),this)])},P.prototype.removeJscryptoKey=function(){var t=s.bind((function(t){t&&(d.deleteKey().error&&p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DELETE_KEY")))}),this);y.showPopup(b,[this.exportKeyBound,this.keyName(),t])},P.prototype.getCurrentValues=function(){return[this.enableJscrypto(),this.enableInPersonalStorage()]},P.prototype.revertGlobalValues=function(){this.enableJscrypto(v.enableJscrypto()),this.enableInPersonalStorage(v.EnableInPersonalStorage)},P.prototype.getParametersForSave=function(){return{EnableModule:this.enableJscrypto(),EnableInPersonalStorage:this.enableInPersonalStorage()}},P.prototype.applySavedValues=function(){v.update(this.enableJscrypto(),this.enableInPersonalStorage())},P.prototype.onShow=a(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d.loadKeyNameFromStorage(),t.next=3,C.isPrivateKeyAvailable();case 3:e=t.sent,this.isPGPKeysAvailable(e),this.allowKeysManagement(!!this.keyName());case 6:case"end":return t.stop()}}),t,this)}))),P.prototype.exportKey=function(){var t=null,e=null,n=document.createElement("a");d.getKey(s.bind((function(r){r?d.exportKey().then(s.bind((function(r){t=new Blob([g.Array2HexString(new Uint8Array(r))],{type:"text/plain"}),e=window.URL.createObjectURL(t),document.body.appendChild(n),n.style="display: none",n.href=e,n.download=this.keyName(),n.click(),window.URL.revokeObjectURL(e)}),this)).catch((function(){p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))})):p.showError(l.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))}),this),!1,!1,!0)},t.exports=new P},mtgd:function(t,e,n){"use strict";(function(e){var r=n("xG9w"),o=n("0h2I"),i=n("czxF"),a=n("RN+F"),s=n("SQrT");function c(){i.call(this),this.keyPassword=o.observable(""),this.keyPasswordConfirm=o.observable(""),this.fOnPasswordEnterCallback=null,this.fOnWrongPasswordCallback=null,this.fOnCancellCallback=null}r.extendOwn(c.prototype,i.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_EncryptKeyPasswordPopup",c.prototype.onOpen=function(t,e){this.fOnPasswordEnterCallback=t,this.fOnCancellCallback=e},c.prototype.encryptKey=function(){""===e.trim(this.keyPassword())?this.showError(a.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_PASSWORD_CANT_BE_BLANK")):e.trim(this.keyPassword())!==e.trim(this.keyPasswordConfirm())?this.showError(a.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")):(r.isFunction(this.fOnPasswordEnterCallback)&&this.fOnPasswordEnterCallback(e.trim(this.keyPassword())),this.closePopup())},c.prototype.cancelPopup=function(){r.isFunction(this.fOnCancellCallback)&&this.fOnCancellCallback(),this.closePopup()},c.prototype.onShow=function(){this.keyPassword(""),this.keyPasswordConfirm("")},c.prototype.showError=function(t){s.showError(t)},t.exports=new c}).call(this,n("EVdn"))},"nTW+":function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("RN+F"),a=n("czxF"),s=n("76Kh"),c=n("20Ah");function u(){a.call(this),this.fExportKeyCallback=null,this.keyName=o.observable(""),this.fDelete=null,this.fDeleteCallback=null}r.extendOwn(u.prototype,a.prototype),u.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_DeleteKeyPopup",u.prototype.onOpen=function(t,e,n){r.isFunction(t)&&(this.fExportKeyCallback=r.bind((function(){this.closePopup(),t()}),this)),this.keyName(e),this.fDeleteCallback=r.bind((function(t){n.call(this,t),t?this.closePopup():this.showPopup()}),this)},u.prototype.deleteKey=function(){this.hidePopup(),s.showPopup(c,[i.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_DELETE_KEY"),this.fDeleteCallback])},t.exports=new u},oBzO:function(t,e,n){"use strict";var r=n("xG9w"),o=n("RN+F"),i=n("Yjhd"),a=n("o0Bx"),s=n("IAk5"),c=n("HLSX"),u=n("SQrT"),l=n("76Kh"),h=n("20Ah"),p=n("c2EW"),f=n("2d9n"),y=n("Z2LC"),d=n("I5pT"),v=null,E=[],w=!1,m=null;function b(){return"https:"===window.location.protocol}function g(t){t.run("SettingsWebclient","registerSettingsTab",[function(){return n("mHl/")},d.HashModuleName,o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/LABEL_SETTINGS_TAB")]),s.subscribeEvent("AbstractFileModel::FileDownload::before",(function(t){if(t.File&&t.File.IS_FILE){var e=t.File,n=(null==e?void 0:e.oExtendedProps)||!1,r=(null==n?void 0:n.InitializationVector)||!1,i=(null==n?void 0:n.ParanoidKey)||!1,a=(null==n?void 0:n.ParanoidKeyShared)||!1,c=e.sOwnerName===s.getUserPublicId(),l=e.sharedWithMe();d.enableJscrypto()&&r&&(c||l)&&(b()?t.CustomDownloadHandler=function(){v.downloadDividedFile(e,r,null,null,l&&a?a:i)}:(u.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),t.CancelDownload=!0))}})),s.subscribeEvent("Jua::FileUpload::before",(function(t){var e=t.sUid,n=t.sModuleName,i=t.oFileInfo,a=t.fOnChunkReadyCallback,s=t.fRegularUploadFileCallback,c=t.fCancelFunction,h=function(t,e,n){!d.AllowMultiChunkUpload&&t.File.size>v.iChunkSize?(u.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_FILE_SIZE_LIMIT",{VALUE:d.ChunkSizeMb})),c(e),v.oChunkQueue.isProcessed=!1,v.checkQueue()):v.startUpload(t,e,n,r.bind((function(){c(e),v.oChunkQueue.isProcessed=!1,v.checkQueue()}),this))},y=r.bind((function(){E.forEach((function(t){s(t.sUid,t.oFileInfo)})),E=[],w=!1}),this),m=r.bind((function(){E.forEach((function(t){v.oChunkQueue.aFiles.push({fStartUploadCallback:h,oFileInfo:t.oFileInfo,sUid:t.sUid,fOnChunkEncryptCallback:a})})),E=[],w=!1,v.oChunkQueue.isProcessed||(v.oChunkQueue.isProcessed=!0,v.checkQueue())})),g=r.bind((function(){E.forEach((function(t){c(t.sUid)})),E=[],w=!1}));d.enableJscrypto()&&d.EncryptionAllowedModules&&d.EncryptionAllowedModules.length>0&&d.EncryptionAllowedModules.includes(n)&&("encrypted"===t.sStorageType||"personal"===t.sStorageType&&d.EnableInPersonalStorage)?b()?!i.EncryptWithoutConfirm&&"personal"===t.sStorageType&&d.EnableInPersonalStorage?(w||(setTimeout((function(){l.showPopup(p,[m,y,g,E.length,r.map(E,(function(t){return t.oFileInfo.FileName}))])}),10),w=!0),E.push({sUid:e,oFileInfo:i})):!0===v.oChunkQueue.isProcessed?v.oChunkQueue.aFiles.push({fStartUploadCallback:h,oFileInfo:i,sUid:e,fOnChunkEncryptCallback:a}):h(i,e,a):"personal"===t.sStorageType&&d.EnableInPersonalStorage?function(t,e,n,o,i){w||(setTimeout((function(){l.showPopup(f,[n,o,E.length,r.map(E,(function(t){return t.oFileInfo.FileName})),i])}),10),w=!0),E.push({sUid:t,oFileInfo:e})}(e,i,y,g,o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")):(u.showError(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),c(e)):s(e,i)})),s.subscribeEvent("CFilesView::FileDownloadCancel",(function(t){d.enableJscrypto()&&b()&&t.oFile.stopDownloading()})),s.subscribeEvent("CFilesView::FileUploadCancel",(function(t){d.enableJscrypto()&&b()?(v.oChunkQueue.aFiles.forEach((function(e,n,r){t.fOnUploadCancelCallback(e.sUid,e.oFileInfo.FileName)})),v.oChunkQueue.aFiles=[],v.stopUploading(t.sFileUploadUid,t.fOnUploadCancelCallback,t.sFileUploadName)):r.isFunction(t.fOnUploadCancelCallback)&&t.fOnUploadCancelCallback(t.sFileUploadUid,t.sFileUploadName)})),s.subscribeEvent("Jua::FileUploadingError",(function(){d.enableJscrypto()&&b()&&(v.oChunkQueue.isProcessed=!1,v.checkQueue())})),s.subscribeEvent("FilesWebclient::ParseFile::after",(function(t){var e=t[0],n=(null==e?void 0:e.oExtendedProps)||!1,r=(null==n?void 0:n.InitializationVector)||!1,o=!!r,i=(null==n?void 0:n.ParanoidKey)||!1,a=(null==n?void 0:n.ParanoidKeyShared)||!1,c=/\.(png|jpe?g|gif)$/.test(e.fileName().toLowerCase()),u=e.sOwnerName===s.getUserPublicId(),h=e.sharedWithMe();o&&(e.thumbnailSrc(""),(u||h)&&c&&d.enableJscrypto()?e.oActionsData.view.Handler=function(){v.viewEncryptedImage(e,r,h&&a?a:i)}:e.removeAction("view"),e.removeAction("list"),e.bIsSecure(!0),e.onSecureIconClick=function(t){l.showPopup(y,[e,r])})})),s.subscribeEvent("FileViewerWebclientPlugin::FilesCollection::after",(function(t){t.aFilesCollection(r.filter(t.aFilesCollection(),(function(t){return!(void 0!==t.oExtendedProps&&void 0!==t.oExtendedProps.InitializationVector)})))})),d.enableJscrypto.subscribe((function(t){null!==m&&m.requestStorages()})),s.subscribeEvent("FilesWebclient::ConstructView::after",(function(e){if("CFilesView"===e.Name){m=e.View;var n=t.run("MailWebclient","getComposeMessageWithAttachments");r.isFunction(n)&&(m.executeSend=function(){var t=this.selector.listCheckedAndSelected(),e=r.filter(t,(function(t){return t&&t.IS_FILE}),this),i=!1,s=r.map(e,(function(t){var e=!(!t.oExtendedProps||!t.oExtendedProps.InitializationVector);return i=i||e,{Storage:t.storageType(),Path:t.path(),Name:t.id()||t.fileName(),IsEncrypted:e}}));this.bAllowSendEmails&&e.length>0&&(i?l.showPopup(h,[o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ALERT_SEND_ENCRYPTED_FILES"),function(t){t&&a.send("Files","SaveFilesAsTempFiles",{Files:s},(function(t){t.Result&&n(t.Result)}),this)}.bind(this)]):a.send("Files","SaveFilesAsTempFiles",{Files:s},(function(t){t.Result&&n(t.Result)}),this))},m.sendCommand=i.createCommand(m,m.executeSend,(function(){if(!this.isZipFolder()&&this.allSelectedFilesReady()){var t=this.selector.listCheckedAndSelected();return r.filter(t,(function(t){return t&&t.IS_FILE}),this).length>0}return!1})))}}));var e=n("MYcH");s.subscribeEvent("SharedFiles::UpdateShare::before",e.onBeforeUpdateShare),s.subscribeEvent("SharedFiles::OpenFilesSharePopup",(function(t){t.IsDir&&t.DialogHintText(o.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_SHARING_FOLDER"))}))}t.exports=function(t){return d.init(t),{start:function(t){v=n("QJDP"),t.run("OpenPgpWebclient","getOpenPgpEncryptor"),window.Blob&&window.URL&&r.isFunction(window.URL.createObjectURL)&&(c.chrome&&!b()?g(t):window.crypto&&window.crypto.subtle&&(c.edge||g(t)))},getConfirmEncryptionPopup:function(){return!!d.EnableInPersonalStorage&&p},isEnabled:function(){return d.enableJscrypto()&&b()}}}},t19A:function(t,e,n){"use strict";var r=n("xG9w"),o=n("0h2I"),i=n("czxF");function a(){i.call(this),this.fExportKeyCallback=null,this.keyName=o.observable("")}r.extendOwn(a.prototype,i.prototype),a.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ExportInformationPopup",a.prototype.onOpen=function(t,e){r.isFunction(t)&&(this.fExportKeyCallback=r.bind((function(){this.closePopup(),t()}),this)),this.keyName(e)},t.exports=new a},"uN/E":function(t,e,n){var r,o=o||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,n=function(){return t.URL||t.webkitURL||t},r=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in r,i=/constructor/i.test(t.HTMLElement)||t.safari,a=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},c=function(t){setTimeout((function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()}),4e4)},u=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},l=function(e,l,h){h||(e=u(e));var p,f=this,y="application/octet-stream"===e.type,d=function(){!function(t,e,n){for(var r=(e=[].concat(e)).length;r--;){var o=t["on"+e[r]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){s(t)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,o)return p=n().createObjectURL(e),void setTimeout((function(){var t,e;r.href=p,r.download=l,t=r,e=new MouseEvent("click"),t.dispatchEvent(e),d(),c(p),f.readyState=f.DONE}));!function(){if((a||y&&i)&&t.FileReader){var r=new FileReader;return r.onloadend=function(){var e=a?r.result:r.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,f.readyState=f.DONE,d()},r.readAsDataURL(e),void(f.readyState=f.INIT)}(p||(p=n().createObjectURL(e)),y)?t.location.href=p:t.open(p,"_blank")||(t.location.href=p);f.readyState=f.DONE,d(),c(p)}()},h=l.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=u(t)),navigator.msSaveOrOpenBlob(t,e)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(t,e,n){return new l(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);t.exports?t.exports.saveAs=o:null!==n("B9Yq")&&null!==n("PDX0")&&(void 0===(r=function(){return o}.call(e,n,e,t))||(t.exports=r))},wjWM:function(t,e,n){"use strict";var r=n("xG9w"),o={Array2HexString:function(t){var e="";return r.each(t,(function(t){var n=t.toString(16);e+=(1===n.length?"0":"")+n})),e},HexString2Array:function(t){var e=[];if(0===t.length||t.length%2!=0)return e;for(var n=0;n<t.length;n+=2)e.push(parseInt(t.substr(n,2),16));return e}};t.exports=o},zDR0:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(){o=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function h(t,e,n,r){var o=e&&e.prototype instanceof y?e:y,a=Object.create(o.prototype),s=new x(r||[]);return i(a,"_invoke",{value:P(t,n,s)}),a}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=h;var f={};function y(){}function d(){}function v(){}var E={};l(E,s,(function(){return this}));var w=Object.getPrototypeOf,m=w&&w(w(I([])));m&&m!==e&&n.call(m,s)&&(E=m);var b=v.prototype=y.prototype=Object.create(E);function g(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){var o;i(this,"_invoke",{value:function(i,a){function s(){return new e((function(o,s){!function o(i,a,s,c){var u=p(t[i],t,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==r(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){o("next",t,s,c)}),(function(t){o("throw",t,s,c)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return o("throw",t,s,c)}))}c(u.arg)}(i,a,o,s)}))}return o=o?o.then(s,s):s()}})}function P(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return R()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=N(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=p(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function N(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,N(t,e),"throw"===e.method))return f;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=p(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function I(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:R}}function R(){return{value:void 0,done:!0}}return d.prototype=v,i(b,"constructor",{value:v,configurable:!0}),i(v,"constructor",{value:d,configurable:!0}),d.displayName=l(v,u,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},g(C.prototype),l(C.prototype,c,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new C(h(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(b),l(b,u,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=I,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:I(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function i(t,e,n,r,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function s(t){i(a,r,o,s,c,"next",t)}function c(t){i(a,r,o,s,c,"throw",t)}s(void 0)}))}}var s=n("xG9w"),c=n("0h2I"),u=n("RN+F"),l=n("gcBV"),h=n("SQrT"),p=n("hPb3"),f=n("wjWM"),y=n("76Kh"),d=n("LU2F"),v=n("mtgd");function E(){this.sPrefix="user_"+(p.UserId||"0")+"_",this.key=c.observable(),this.keyName=c.observable(),this.storageName="cryptoKeyEncrypted"}E.prototype.key=null,E.prototype.sPrefix="",E.prototype.getKey=function(t,e,n,r){var o=this.loadKeyFromStorage(),i=new Promise(function(t,i){var a=s.bind((function(e){this.decryptKeyData(o,e).then(s.bind((function(e){this.generateKeyFromArray(e).then((function(e){t(e)})).catch((function(t){i(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this)).catch((function(t){i(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this);o?!this.key()||r?n?a(n):y.showPopup(d,[a,function(){s.isFunction(e)&&e()}]):t(this.key()):i(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY")))}.bind(this));this.loadKeyNameFromStorage(),i.then(s.bind((function(e){this.onKeyGenerateSuccess(e),s.isFunction(t)&&t(e)}),this)).catch(s.bind((function(t){s.isFunction(e)&&e(),this.onKeyGenerateError(t)}),this))},E.prototype.loadKeyNameFromStorage=function(){l.hasData(this.getStorageName())&&this.keyName(l.getData(this.getStorageName()).keyname)},E.prototype.loadKeyFromStorage=function(){var t="";return l.hasData(this.getStorageName())&&(t=l.getData(this.getStorageName()).keydata),t},E.prototype.generateKeyFromArray=function(t){return window.crypto.subtle.importKey("raw",t,{name:"AES-CBC"},!0,["encrypt","decrypt"])},E.prototype.onKeyGenerateSuccess=function(t){this.key(t)},E.prototype.onKeyGenerateError=function(t){t&&t.message&&h.showError(t.message)},E.prototype.generateKey=a(o().mark((function t(){var e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=!1,t.prev=1,t.next=4,window.crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]);case 4:e=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),h.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_GENERATE_KEY"));case 10:return t.abrupt("return",e);case 11:case"end":return t.stop()}}),t,null,[[1,7]])}))),E.prototype.convertKeyToString=function(){var t=a(o().mark((function t(e){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n="",!e){t.next=12;break}return t.prev=2,t.next=5,window.crypto.subtle.exportKey("raw",e);case 5:r=t.sent,n=f.Array2HexString(new Uint8Array(r)),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),h.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_EXPORT_KEY"));case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t,null,[[2,9]])})));return function(e){return t.apply(this,arguments)}}(),E.prototype.generateAndExportKey=function(){var t=a(o().mark((function t(e,n){var r,i,c=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.generateKey();case 2:return r=t.sent,t.next=5,this.convertKeyToString(r);case 5:i=t.sent,y.showPopup(v,[function(){var t=a(o().mark((function t(a){var p;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c.encryptKeyData(i,a);case 3:p=t.sent,l.setData(c.getStorageName(),{keyname:n,keydata:p}),c.loadKeyNameFromStorage(),c.onKeyGenerateSuccess(r),s.isFunction(e)&&e(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),h.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"));case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}(),function(){}]);case 7:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}(),E.prototype.getKeyFromString=function(){var t=a(o().mark((function t(e){var n,r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=null,(r=f.HexString2Array(e)).length>0?r=new Uint8Array(r):h.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")),t.prev=3,t.next=6,this.generateKeyFromArray(r);case 6:n=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),h.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"));case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t,this,[[3,9]])})));return function(e){return t.apply(this,arguments)}}(),E.prototype.importKeyFromString=function(t,e,n,r){try{y.showPopup(v,[s.bind((function(o){this.encryptKeyData(e,o).then(s.bind((function(e){l.setData(this.getStorageName(),{keyname:t,keydata:e}),this.getKey(n,r,o)}),this)).catch((function(){h.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")),s.isFunction(r)&&r()}))}),this),function(){s.isFunction(r)&&r()}])}catch(t){h.showError(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY")),s.isFunction(r)&&r()}},E.prototype.exportKey=function(){return window.crypto.subtle.exportKey("raw",this.key())},E.prototype.deleteKey=function(){try{this.key(null),this.keyName(null),l.removeData(this.getStorageName())}catch(t){return{error:t}}return{status:"ok"}},E.prototype.decryptKeyData=function(t,e){var n=new Uint8Array(16);return new Promise(function(r,o){t?this.deriveKeyFromPasswordPromise(e,s.bind((function(e){crypto.subtle.decrypt({name:"AES-CBC",iv:n},e,new Uint8Array(f.HexString2Array(t))).then(s.bind((function(t){r(new Uint8Array(t))}),this)).catch((function(){o(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this),(function(){o(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))})):o(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}.bind(this))},E.prototype.encryptKeyData=function(t,e){var n=null,r=null,o=new Uint8Array(16);return new Promise(function(i,a){t?((n=f.HexString2Array(t)).length>0?n=new Uint8Array(n):a(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))),this.deriveKeyFromPasswordPromise(e,s.bind((function(t){crypto.subtle.encrypt({name:"AES-CBC",iv:o},t,n).then(s.bind((function(t){r=f.Array2HexString(new Uint8Array(t)),i(r)}),this)).catch((function(){a(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this),(function(){a(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))):a(new Error(u.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}.bind(this))},E.prototype.deriveKeyFromPasswordPromise=function(t,e,n){var r=function(t){if(window.TextEncoder)return new TextEncoder("utf-8").encode(t);for(var e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n};window.crypto.subtle.importKey("raw",r(t),{name:"PBKDF2"},!1,["deriveKey"]).then(s.bind((function(t){window.crypto.subtle.deriveKey({name:"PBKDF2",salt:r("the salt is this string"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]).then((function(t){s.isFunction(e)&&e(t)})).catch((function(){s.isFunction(n)&&n()}))}),this)).catch((function(){s.isFunction(n)&&n()}))},E.prototype.getStorageName=function(){return this.sPrefix+this.storageName},t.exports=new E}}]);